name: go_006_go_mod_require
initial:
  go.mod: |
    module myproject

    go 1.21

    require (
        github.com/gin-gonic/gin v1.9.0
        github.com/go-playground/validator/v10 v10.14.0
        go.uber.org/zap v1.24.0
    )

  internal/server/server.go: |
    package server

    import (
        "github.com/gin-gonic/gin"
        "go.uber.org/zap"
    )

    type Server struct {
        router *gin.Engine
        logger *zap.Logger
    }

    func NewServer(logger *zap.Logger) *Server {
        r := gin.Default()
        return &Server{router: r, logger: logger}
    }

    func (s *Server) Run(addr string) error {
        s.logger.Info("Starting server", zap.String("addr", addr))
        return s.router.Run(addr)
    }

    func (s *Server) SetupRoutes() {
        s.router.GET("/health", s.healthCheck)
        s.router.GET("/api/v1/users", s.listUsers)
        s.router.POST("/api/v1/users", s.createUser)
    }

    func (s *Server) healthCheck(c *gin.Context) {
        c.JSON(200, gin.H{"status": "ok"})
    }

    func (s *Server) listUsers(c *gin.Context) {
        c.JSON(200, gin.H{"users": []string{}})
    }

    func (s *Server) createUser(c *gin.Context) {
        c.JSON(201, gin.H{"id": 1})
    }

  cmd/main.go: |
    package main

    import (
        "myproject/internal/server"
        "go.uber.org/zap"
    )

    func main() {
        logger, _ := zap.NewProduction()
        defer logger.Sync()

        srv := server.NewServer(logger)
        srv.SetupRoutes()
        srv.Run(":8080")
    }

  internal/unrelated/analytics/tracker.go: |
    package analytics

    const GARBAGE_GO_ANALYTICS_TRACK_001 = "analytics_garbage"

    type GARBAGE_GO_TYPE_TRACKER_002 struct {
        endpoint string
    }

    func GARBAGE_GO_FUNC_TRACKER_003() string {
        return "GARBAGE_GO_TRACKER_UNUSED_004"
    }

  internal/unrelated/payment/stripe.go: |
    package payment

    const GARBAGE_GO_PAYMENT_STRIPE_005 = "payment_garbage"

    type GARBAGE_GO_TYPE_PAYMENT_006 struct {
        apiKey string
    }

    func GARBAGE_GO_FUNC_PAYMENT_007() {
        println("GARBAGE_GO_PAYMENT_OUTPUT_008")
    }

changed:
  go.mod: |
    module myproject

    go 1.21

    require (
        github.com/gin-gonic/gin v1.9.0
        github.com/go-playground/validator/v10 v10.14.0
        github.com/redis/go-redis/v9 v9.0.0
        github.com/jackc/pgx/v5 v5.4.0
        go.uber.org/zap v1.24.0
        golang.org/x/sync v0.3.0
    )

assertions:
  must_include:
    - go.mod
    - redis
    - pgx
    - golang.org/x/sync
  must_not_include:
    - GARBAGE_GO_ANALYTICS_TRACK_001
    - GARBAGE_GO_TYPE_TRACKER_002
    - GARBAGE_GO_FUNC_TRACKER_003
    - GARBAGE_GO_TRACKER_UNUSED_004
    - GARBAGE_GO_PAYMENT_STRIPE_005
    - GARBAGE_GO_TYPE_PAYMENT_006
    - GARBAGE_GO_FUNC_PAYMENT_007
    - GARBAGE_GO_PAYMENT_OUTPUT_008
    - analytics
    - stripe
options:
  commit_message: Add redis, pgx, and sync dependencies
