name: go_003_interface_implementations
initial:
  internal/storage/interfaces.go: |
    package storage

    import "context"

    type Storage interface {
        Save(ctx context.Context, key string, data []byte) error
        Load(ctx context.Context, key string) ([]byte, error)
    }

    type StorageWithMeta interface {
        Storage
        GetMetadata(ctx context.Context, key string) (*Metadata, error)
    }

    type Metadata struct {
        Size        int64
        ContentType string
        CreatedAt   int64
        UpdatedAt   int64
    }

  internal/storage/file_storage.go: |
    package storage

    import (
        "context"
        "os"
        "path/filepath"
    )

    type FileStorage struct {
        basePath string
    }

    func NewFileStorage(basePath string) *FileStorage {
        return &FileStorage{basePath: basePath}
    }

    func (f *FileStorage) Save(ctx context.Context, key string, data []byte) error {
        path := filepath.Join(f.basePath, key)
        dir := filepath.Dir(path)
        if err := os.MkdirAll(dir, 0755); err != nil {
            return err
        }
        return os.WriteFile(path, data, 0644)
    }

    func (f *FileStorage) Load(ctx context.Context, key string) ([]byte, error) {
        path := filepath.Join(f.basePath, key)
        return os.ReadFile(path)
    }

  internal/storage/memory_storage.go: |
    package storage

    import (
        "context"
        "errors"
        "sync"
    )

    var ErrKeyNotFound = errors.New("key not found")

    type MemoryStorage struct {
        mu   sync.RWMutex
        data map[string][]byte
    }

    func NewMemoryStorage() *MemoryStorage {
        return &MemoryStorage{
            data: make(map[string][]byte),
        }
    }

    func (m *MemoryStorage) Save(ctx context.Context, key string, data []byte) error {
        m.mu.Lock()
        defer m.mu.Unlock()
        m.data[key] = data
        return nil
    }

    func (m *MemoryStorage) Load(ctx context.Context, key string) ([]byte, error) {
        m.mu.RLock()
        defer m.mu.RUnlock()
        if data, ok := m.data[key]; ok {
            return data, nil
        }
        return nil, ErrKeyNotFound
    }

  internal/unrelated/auth/authenticator.go: |
    package auth

    import "time"

    const GARBAGE_GO_AUTH_IMPL_001 = "auth_garbage_marker"

    type GARBAGE_GO_TYPE_AUTH_002 struct {
        secret string
    }

    func GARBAGE_GO_FUNC_AUTH_003() string {
        return "GARBAGE_GO_AUTH_UNUSED_004"
    }

    type TokenClaims struct {
        UserID    int64
        ExpiresAt time.Time
    }

  internal/unrelated/logging/structured_logger.go: |
    package logging

    const GARBAGE_GO_LOGGER_IMPL_005 = "logger_garbage"

    type GARBAGE_GO_TYPE_LOGGER_006 struct {
        level string
    }

    func GARBAGE_GO_FUNC_LOGGER_007() {
        println("GARBAGE_GO_LOGGER_OUTPUT_008")
    }

changed:
  internal/storage/interfaces.go: |
    package storage

    import "context"

    type Storage interface {
        Save(ctx context.Context, key string, data []byte) error
        Load(ctx context.Context, key string) ([]byte, error)
        Delete(ctx context.Context, key string) error
        Exists(ctx context.Context, key string) (bool, error)
    }

    type StorageWithMeta interface {
        Storage
        GetMetadata(ctx context.Context, key string) (*Metadata, error)
        SetMetadata(ctx context.Context, key string, meta *Metadata) error
    }

    type ListableStorage interface {
        Storage
        List(ctx context.Context, prefix string) ([]string, error)
        ListWithMeta(ctx context.Context, prefix string) ([]*StorageItem, error)
    }

    type StorageItem struct {
        Key      string
        Size     int64
        Metadata *Metadata
    }

    type Metadata struct {
        Size        int64
        ContentType string
        CreatedAt   int64
        UpdatedAt   int64
        Checksum    string
    }

assertions:
  must_include:
    - Storage
    - Delete
    - Exists
    - ListableStorage
    - List
    - ListWithMeta
    - StorageItem
    - Checksum
  must_not_include:
    - GARBAGE_GO_AUTH_IMPL_001
    - GARBAGE_GO_TYPE_AUTH_002
    - GARBAGE_GO_FUNC_AUTH_003
    - GARBAGE_GO_AUTH_UNUSED_004
    - GARBAGE_GO_LOGGER_IMPL_005
    - GARBAGE_GO_TYPE_LOGGER_006
    - GARBAGE_GO_FUNC_LOGGER_007
    - GARBAGE_GO_LOGGER_OUTPUT_008
    - authenticator
    - structured_logger
options:
  commit_message: Add Delete, Exists, List methods to Storage interface
