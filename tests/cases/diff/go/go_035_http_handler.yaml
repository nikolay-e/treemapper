name: go_035_http_handler
initial:
  handlers.go: |
    package main

    type UserHandler struct{}
  router.go: |
    package main

    import "net/http"

    func SetupRoutes(mux *http.ServeMux) {}
  unrelated/garbage.go: |
    package unrelated

    func UnusedHandlers_12345() {
        println("garbage_marker_12345")
    }

    func UnusedRouter_67890() {
        println("unused_marker_67890")
    }
changed:
  handlers.go: |
    package main

    import (
        "encoding/json"
        "net/http"
    )

    type UserHandler struct {
        service *UserService
    }

    func NewUserHandler(svc *UserService) *UserHandler {
        return &UserHandler{service: svc}
    }

    func (h *UserHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {
        switch r.Method {
        case http.MethodGet:
            h.handleGet(w, r)
        case http.MethodPost:
            h.handlePost(w, r)
        default:
            http.Error(w, "Method not allowed", http.StatusMethodNotAllowed)
        }
    }

    func (h *UserHandler) handleGet(w http.ResponseWriter, r *http.Request) {
        users := h.service.GetAll()
        json.NewEncoder(w).Encode(users)
    }

    func (h *UserHandler) handlePost(w http.ResponseWriter, r *http.Request) {
        var user User
        if err := json.NewDecoder(r.Body).Decode(&user); err != nil {
            http.Error(w, err.Error(), http.StatusBadRequest)
            return
        }
        h.service.Create(&user)
        w.WriteHeader(http.StatusCreated)
    }
  router.go: |
    package main

    import "net/http"

    func SetupRoutes(mux *http.ServeMux, userHandler *UserHandler) {
        mux.Handle("/users", userHandler)
        mux.Handle("/users/", userHandler)
    }
assertions:
  must_include:
  - UserHandler
  - ServeHTTP
  - handleGet
  - handlePost
  must_not_include:
  - garbage_marker_12345
  - unused_marker_67890
options:
  commit_message: Add HTTP handlers
