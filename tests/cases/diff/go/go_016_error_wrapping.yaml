name: go_016_error_wrapping
initial:
  errors.go: |
    package main

    import "errors"

    var ErrNotFound = errors.New("not found")
    var ErrPermission = errors.New("permission denied")
  service.go: |
    package main

    func GetUser(id int) (*User, error) {
        return nil, nil
    }
  unrelated/garbage.go: |
    package unrelated

    func UnusedErrors_12345() {
        println("garbage_marker_12345")
    }

    func UnusedService_67890() {
        println("unused_marker_67890")
    }
changed:
  service.go: |
    package main

    import "fmt"

    func GetUser(id int) (*User, error) {
        user, err := repo.Find(id)
        if err != nil {
            return nil, fmt.Errorf("GetUser(%d): %w", id, err)
        }
        return user, nil
    }

    func GetUserOrDefault(id int) *User {
        user, err := GetUser(id)
        if errors.Is(err, ErrNotFound) {
            return &User{Name: "Guest"}
        }
        return user
    }
assertions:
  must_include:
  - GetUser
  - GetUserOrDefault
  - Errorf
  must_not_include:
  - garbage_marker_12345
  - unused_marker_67890
options:
  commit_message: Add error wrapping
