name: go_033_error_interface
initial:
  errors.go: |
    package main

    import "errors"

    var ErrNotFound = errors.New("not found")
  service.go: |
    package main

    func Find(id int) (interface{}, error) {
        return nil, ErrNotFound
    }
  unrelated/garbage.go: |
    package unrelated

    func UnusedErrors_12345() {
        println("garbage_marker_12345")
    }

    func UnusedService_67890() {
        println("unused_marker_67890")
    }
changed:
  errors.go: |
    package main

    import "fmt"

    type AppError struct {
        Code    int
        Message string
        Err     error
    }

    func (e *AppError) Error() string {
        if e.Err != nil {
            return fmt.Sprintf("[%d] %s: %v", e.Code, e.Message, e.Err)
        }
        return fmt.Sprintf("[%d] %s", e.Code, e.Message)
    }

    func (e *AppError) Unwrap() error {
        return e.Err
    }

    func NewNotFoundError(resource string) *AppError {
        return &AppError{Code: 404, Message: resource + " not found"}
    }

    func NewValidationError(msg string, err error) *AppError {
        return &AppError{Code: 400, Message: msg, Err: err}
    }
assertions:
  must_include:
  - AppError
  - Error()
  - Unwrap
  must_not_include:
  - garbage_marker_12345
  - unused_marker_67890
options:
  commit_message: Add custom error type
