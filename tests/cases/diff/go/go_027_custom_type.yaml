name: go_027_custom_type
initial:
  internal/domain/types.go: |
    package domain

    import "time"

    type UserID int64
    type OrderID int64
    type ProductID int64

    type Status string

    const (
        StatusPending   Status = "pending"
        StatusActive    Status = "active"
        StatusCompleted Status = "completed"
        StatusCancelled Status = "cancelled"
    )

    func (s Status) IsActive() bool {
        return s == StatusActive
    }

    func (s Status) IsFinal() bool {
        return s == StatusCompleted || s == StatusCancelled
    }

    type Priority int

    const (
        PriorityLow    Priority = 1
        PriorityMedium Priority = 2
        PriorityHigh   Priority = 3
        PriorityCritical Priority = 4
    )

    type Money struct {
        Amount   int64
        Currency string
    }

    type DateRange struct {
        Start time.Time
        End   time.Time
    }

    func (d DateRange) Contains(t time.Time) bool {
        return !t.Before(d.Start) && !t.After(d.End)
    }

  internal/domain/service.go: |
    package domain

    func GetUserStatus(id int) string {
        return "unknown"
    }

    func GetOrderPriority(id int) int {
        return 0
    }

  internal/unrelated/analytics/tracker.go: |
    package analytics

    import "context"

    const GARBAGE_GO_ANALYTICS_TRACKER_A1B2C3 = "analytics_garbage_marker"

    type GARBAGE_GO_TYPE_EVENT_D4E5F6 struct {
        name       string
        properties map[string]interface{}
    }

    func GARBAGE_GO_FUNC_ANALYTICS_G7H8I9() string {
        return "GARBAGE_GO_ANALYTICS_UNUSED_J0K1L2"
    }

    type AnalyticsConfig struct {
        APIKey      string
        Endpoint    string
        BatchSize   int
        FlushInterval int
    }

    func GARBAGE_GO_FUNC_TRACK_EVENT_M3N4O5(ctx context.Context, event string) error {
        println("GARBAGE_GO_TRACK_OUTPUT_P6Q7R8")
        return nil
    }

  internal/unrelated/analytics/segment.go: |
    package analytics

    const GARBAGE_GO_SEGMENT_CLIENT_S9T0U1 = "segment_garbage"

    type GARBAGE_GO_TYPE_SEGMENT_V2W3X4 struct {
        writeKey string
        client   interface{}
    }

    func GARBAGE_GO_FUNC_SEGMENT_Y5Z6A7() {
        println("GARBAGE_GO_SEGMENT_OUTPUT_B8C9D0")
    }

    type SegmentConfig struct {
        WriteKey  string
        Endpoint  string
        Verbose   bool
    }

    func GARBAGE_GO_FUNC_SEGMENT_IDENTIFY_E1F2G3(userID string) error {
        return nil
    }

  internal/unrelated/analytics/mixpanel.go: |
    package analytics

    const GARBAGE_GO_MIXPANEL_CLIENT_H4I5J6 = "mixpanel_garbage"

    type GARBAGE_GO_TYPE_MIXPANEL_K7L8M9 struct {
        token     string
        projectID string
    }

    func GARBAGE_GO_FUNC_MIXPANEL_N0O1P2() {
        println("GARBAGE_GO_MIXPANEL_OUTPUT_Q3R4S5")
    }

changed:
  internal/domain/service.go: |
    package domain

    import (
        "errors"
        "fmt"
        "time"
    )

    var (
        ErrUserNotFound    = errors.New("user not found")
        ErrOrderNotFound   = errors.New("order not found")
        ErrInvalidStatus   = errors.New("invalid status transition")
        ErrInvalidPriority = errors.New("invalid priority")
    )

    type UserStatusService struct {
        statuses map[UserID]Status
    }

    func NewUserStatusService() *UserStatusService {
        return &UserStatusService{
            statuses: make(map[UserID]Status),
        }
    }

    func (s *UserStatusService) GetStatus(id UserID) (Status, error) {
        status, ok := s.statuses[id]
        if !ok {
            return "", ErrUserNotFound
        }
        return status, nil
    }

    func (s *UserStatusService) SetStatus(id UserID, status Status) error {
        if !status.IsValid() {
            return ErrInvalidStatus
        }
        s.statuses[id] = status
        return nil
    }

    func (s Status) IsValid() bool {
        switch s {
        case StatusPending, StatusActive, StatusCompleted, StatusCancelled:
            return true
        }
        return false
    }

    func (s Status) CanTransitionTo(target Status) bool {
        transitions := map[Status][]Status{
            StatusPending:   {StatusActive, StatusCancelled},
            StatusActive:    {StatusCompleted, StatusCancelled},
            StatusCompleted: {},
            StatusCancelled: {},
        }
        allowed, ok := transitions[s]
        if !ok {
            return false
        }
        for _, t := range allowed {
            if t == target {
                return true
            }
        }
        return false
    }

    type OrderService struct {
        priorities map[OrderID]Priority
        statuses   map[OrderID]Status
    }

    func NewOrderService() *OrderService {
        return &OrderService{
            priorities: make(map[OrderID]Priority),
            statuses:   make(map[OrderID]Status),
        }
    }

    func (s *OrderService) GetPriority(id OrderID) (Priority, error) {
        priority, ok := s.priorities[id]
        if !ok {
            return 0, ErrOrderNotFound
        }
        return priority, nil
    }

    func (s *OrderService) SetPriority(id OrderID, priority Priority) error {
        if !priority.IsValid() {
            return ErrInvalidPriority
        }
        s.priorities[id] = priority
        return nil
    }

    func (p Priority) IsValid() bool {
        return p >= PriorityLow && p <= PriorityCritical
    }

    func (p Priority) String() string {
        switch p {
        case PriorityLow:
            return "low"
        case PriorityMedium:
            return "medium"
        case PriorityHigh:
            return "high"
        case PriorityCritical:
            return "critical"
        default:
            return "unknown"
        }
    }

    func (p Priority) Urgency() time.Duration {
        switch p {
        case PriorityCritical:
            return 1 * time.Hour
        case PriorityHigh:
            return 4 * time.Hour
        case PriorityMedium:
            return 24 * time.Hour
        default:
            return 72 * time.Hour
        }
    }

    func NewMoney(amount int64, currency string) Money {
        return Money{Amount: amount, Currency: currency}
    }

    func (m Money) Add(other Money) (Money, error) {
        if m.Currency != other.Currency {
            return Money{}, fmt.Errorf("currency mismatch: %s vs %s", m.Currency, other.Currency)
        }
        return Money{Amount: m.Amount + other.Amount, Currency: m.Currency}, nil
    }

    func (m Money) Subtract(other Money) (Money, error) {
        if m.Currency != other.Currency {
            return Money{}, fmt.Errorf("currency mismatch: %s vs %s", m.Currency, other.Currency)
        }
        return Money{Amount: m.Amount - other.Amount, Currency: m.Currency}, nil
    }

    func (m Money) Multiply(factor int64) Money {
        return Money{Amount: m.Amount * factor, Currency: m.Currency}
    }

    func (m Money) String() string {
        return fmt.Sprintf("%d.%02d %s", m.Amount/100, m.Amount%100, m.Currency)
    }

    func (m Money) IsPositive() bool {
        return m.Amount > 0
    }

    func (m Money) IsZero() bool {
        return m.Amount == 0
    }

assertions:
  must_include:
    - UserID
    - OrderID
    - Status
    - Priority
    - Money
    - UserStatusService
    - OrderService
    - GetStatus
    - SetStatus
    - GetPriority
    - SetPriority
    - CanTransitionTo
    - IsValid
    - Urgency
    - Add
    - Subtract
    - Multiply
  must_not_include:
    - GARBAGE_GO_ANALYTICS_TRACKER_A1B2C3
    - GARBAGE_GO_TYPE_EVENT_D4E5F6
    - GARBAGE_GO_FUNC_ANALYTICS_G7H8I9
    - GARBAGE_GO_ANALYTICS_UNUSED_J0K1L2
    - GARBAGE_GO_FUNC_TRACK_EVENT_M3N4O5
    - GARBAGE_GO_TRACK_OUTPUT_P6Q7R8
    - GARBAGE_GO_SEGMENT_CLIENT_S9T0U1
    - GARBAGE_GO_TYPE_SEGMENT_V2W3X4
    - GARBAGE_GO_FUNC_SEGMENT_Y5Z6A7
    - GARBAGE_GO_SEGMENT_OUTPUT_B8C9D0
    - GARBAGE_GO_FUNC_SEGMENT_IDENTIFY_E1F2G3
    - GARBAGE_GO_MIXPANEL_CLIENT_H4I5J6
    - GARBAGE_GO_TYPE_MIXPANEL_K7L8M9
    - GARBAGE_GO_FUNC_MIXPANEL_N0O1P2
    - GARBAGE_GO_MIXPANEL_OUTPUT_Q3R4S5
    - tracker
    - segment
    - mixpanel

options:
  commit_message: Add comprehensive custom type methods for Status, Priority, and Money
