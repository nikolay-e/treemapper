name: ts_003_generic_constraint
initial:
  entities.ts: |
    export interface BaseEntity {
        id: string;
        createdAt: Date;
        updatedAt: Date;
    }

    export interface Identifiable {
        id: string;
    }

    export interface Timestamped {
        createdAt: Date;
        updatedAt: Date;
    }

    // ts_garbage_marker_003
    interface GarbageEntity { garbage: true }
  repository.ts: |
    console.log('initial');
changed:
  repository.ts: |
    import { BaseEntity, Identifiable } from './entities';

    export function findById<T extends BaseEntity>(
        items: T[],
        id: string
    ): T | undefined {
        return items.find(item => item.id === id);
    }

    export function updateEntity<T extends BaseEntity>(
        entity: T,
        updates: Partial<Omit<T, 'id' | 'createdAt'>>
    ): T {
        return {
            ...entity,
            ...updates,
            updatedAt: new Date(),
        };
    }

    export class Repository<T extends Identifiable> {
        private items: Map<string, T> = new Map();

        save(item: T): void {
            this.items.set(item.id, item);
        }

        get(id: string): T | undefined {
            return this.items.get(id);
        }
    }
assertions:
  must_include:
  - repository.ts
  - extends BaseEntity
  must_not_include:
  - ts_garbage_marker_003
options:
  commit_message: Add generic repository with constraints
