name: ts_007_discriminated_union
initial:
  results.ts: |
    export interface Success<T> {
        type: 'success';
        data: T;
        timestamp: Date;
    }

    export interface Failure {
        type: 'failure';
        error: Error;
        code: number;
    }

    export interface Loading {
        type: 'loading';
        progress?: number;
    }

    // ts_garbage_marker_007
    interface GarbageResult { type: 'garbage' }
  handlers.ts: |
    console.log('initial');
changed:
  handlers.ts: |
    import { Success, Failure, Loading } from './results';

    export type Result<T> = Success<T> | Failure | Loading;

    export function handleResult<T>(result: Result<T>): string {
        switch (result.type) {
            case 'success':
                return \`Data received: \${JSON.stringify(result.data)}\`;
            case 'failure':
                return \`Error \${result.code}: \${result.error.message}\`;
            case 'loading':
                return \`Loading... \${result.progress ?? 0}%\`;
        }
    }

    export function isSuccess<T>(result: Result<T>): result is Success<T> {
        return result.type === 'success';
    }

    export function isFailure<T>(result: Result<T>): result is Failure {
        return result.type === 'failure';
    }
assertions:
  must_include:
  - handlers.ts
  - Result<T>
  must_not_include:
  - ts_garbage_marker_007
options:
  commit_message: Add discriminated union handlers
