name: angular_004_httpclient
initial:
  api.types.ts: |
    export interface ApiResponse<T> {
        data: T;
        message: string;
        status: number;
    }

    export interface PaginatedResponse<T> {
        items: T[];
        total: number;
        page: number;
        pageSize: number;
    }

    export interface User {
        id: string;
        name: string;
        email: string;
    }

    export interface CreateUserRequest {
        name: string;
        email: string;
        password: string;
    }

    export interface UpdateUserRequest {
        name?: string;
        email?: string;
    }

    // angular_garbage_marker_004
    const GARBAGE_API_CONFIG = { baseUrl: '/api' };
  api.service.ts: |
    import { Injectable } from '@angular/core';

    @Injectable({ providedIn: 'root' })
    export class ApiService {}
changed:
  api.service.ts: |
    import { Injectable } from '@angular/core';
    import { HttpClient, HttpParams, HttpHeaders } from '@angular/common/http';
    import { Observable, catchError, map } from 'rxjs';
    import {
        ApiResponse,
        PaginatedResponse,
        User,
        CreateUserRequest,
        UpdateUserRequest,
    } from './api.types';

    @Injectable({ providedIn: 'root' })
    export class ApiService {
        private baseUrl = '/api';

        constructor(private http: HttpClient) {}

        getUsers(page = 1, pageSize = 10): Observable<PaginatedResponse<User>> {
            const params = new HttpParams()
                .set('page', page.toString())
                .set('pageSize', pageSize.toString());

            return this.http
                .get<ApiResponse<PaginatedResponse<User>>>(\`\${this.baseUrl}/users\`, { params })
                .pipe(map(response => response.data));
        }

        getUser(id: string): Observable<User> {
            return this.http
                .get<ApiResponse<User>>(\`\${this.baseUrl}/users/\${id}\`)
                .pipe(map(response => response.data));
        }

        createUser(request: CreateUserRequest): Observable<User> {
            const headers = new HttpHeaders().set('Content-Type', 'application/json');

            return this.http
                .post<ApiResponse<User>>(\`\${this.baseUrl}/users\`, request, { headers })
                .pipe(map(response => response.data));
        }

        updateUser(id: string, request: UpdateUserRequest): Observable<User> {
            return this.http
                .patch<ApiResponse<User>>(\`\${this.baseUrl}/users/\${id}\`, request)
                .pipe(map(response => response.data));
        }

        deleteUser(id: string): Observable<void> {
            return this.http
                .delete<void>(\`\${this.baseUrl}/users/\${id}\`)
                .pipe(catchError(error => {
                    console.error('Delete failed:', error);
                    throw error;
                }));
        }
    }
  user-management.component.ts: |
    import { Component, OnInit } from '@angular/core';
    import { ApiService } from './api.service';
    import { User, CreateUserRequest } from './api.types';

    @Component({
        selector: 'app-user-management',
        template: \`
            <div class="user-management">
                <h1>User Management</h1>
                <button (click)="loadUsers()">Refresh</button>
                <ul>
                    <li *ngFor="let user of users">
                        {{ user.name }} ({{ user.email }})
                        <button (click)="deleteUser(user.id)">Delete</button>
                    </li>
                </ul>
                <form (ngSubmit)="createUser()">
                    <input [(ngModel)]="newUser.name" placeholder="Name" name="name" />
                    <input [(ngModel)]="newUser.email" placeholder="Email" name="email" />
                    <input [(ngModel)]="newUser.password" type="password" placeholder="Password" name="password" />
                    <button type="submit">Create</button>
                </form>
            </div>
        \`,
    })
    export class UserManagementComponent implements OnInit {
        users: User[] = [];
        newUser: CreateUserRequest = { name: '', email: '', password: '' };

        constructor(private apiService: ApiService) {}

        ngOnInit(): void {
            this.loadUsers();
        }

        loadUsers(): void {
            this.apiService.getUsers().subscribe(response => {
                this.users = response.items;
            });
        }

        createUser(): void {
            this.apiService.createUser(this.newUser).subscribe(user => {
                this.users.push(user);
                this.newUser = { name: '', email: '', password: '' };
            });
        }

        deleteUser(id: string): void {
            this.apiService.deleteUser(id).subscribe(() => {
                this.users = this.users.filter(u => u.id !== id);
            });
        }
    }
assertions:
  must_include:
  - HttpClient
  must_not_include:
  - angular_garbage_marker_004
options:
  commit_message: Add Angular HttpClient usage
