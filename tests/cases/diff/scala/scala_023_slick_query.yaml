name: scala_023_slick_query
initial:
  Tables.scala: |
    import slick.jdbc.PostgresProfile.api._

    case class User(id: Long, name: String, age: Int, active: Boolean)

    class Users(tag: Tag) extends Table[User](tag, "users") {
      def id = column[Long]("id", O.PrimaryKey, O.AutoInc)
      def name = column[String]("name")
      def age = column[Int]("age")
      def active = column[Boolean]("active")
      def * = (id, name, age, active).mapTo[User]
    }

    object Tables {
      val users = TableQuery[Users]
    }
  UserRepository.scala: |
    class UserRepository {}
changed:
  UserRepository.scala: |
    import slick.jdbc.PostgresProfile.api._
    import scala.concurrent.Future

    class UserRepository(db: Database) {
      import Tables._

      def findAdults(): Future[Seq[User]] = {
        db.run(users.filter(_.age >= 18).result)
      }

      def findActive(): Future[Seq[User]] = {
        db.run(users.filter(_.active === true).result)
      }

      def findByName(name: String): Future[Option[User]] = {
        db.run(users.filter(_.name === name).result.headOption)
      }

      def countByAge(minAge: Int): Future[Int] = {
        db.run(users.filter(_.age >= minAge).length.result)
      }
    }
assertions:
  must_include:
  - UserRepository
  - Tables._
  - db.run
  must_not_include:
  - garbage_marker_12345
  - unused_marker_67890
options:
  commit_message: Add Slick query
