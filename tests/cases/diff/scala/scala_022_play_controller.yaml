name: scala_022_play_controller
initial:
  routes: |
    GET     /users/:id        controllers.UserController.getUser(id: Long)
    POST    /users            controllers.UserController.createUser()
    DELETE  /users/:id        controllers.UserController.deleteUser(id: Long)
  UserController.scala: |
    class UserController {}
changed:
  UserController.scala: |
    import play.api.mvc._
    import play.api.libs.json._
    import scala.concurrent.{ExecutionContext, Future}

    case class User(id: Long, name: String)

    class UserController(cc: ControllerComponents)(implicit ec: ExecutionContext)
        extends AbstractController(cc) {

      implicit val userFormat: Format[User] = Json.format[User]

      def getUser(id: Long): Action[AnyContent] = Action.async {
        Future.successful(Ok(Json.toJson(User(id, "John"))))
      }

      def createUser(): Action[JsValue] = Action.async(parse.json) { request =>
        request.body.validate[User].fold(
          errors => Future.successful(BadRequest(Json.obj("error" -> "Invalid JSON"))),
          user => Future.successful(Created(Json.toJson(user)))
        )
      }

      def deleteUser(id: Long): Action[AnyContent] = Action.async {
        Future.successful(NoContent)
      }
    }
assertions:
  must_include:
  - UserController
  - AbstractController
  - Action.async
  must_not_include:
  - garbage_marker_12345
  - unused_marker_67890
options:
  commit_message: Add Play controller
