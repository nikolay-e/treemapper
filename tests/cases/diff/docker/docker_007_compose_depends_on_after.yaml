src/app.py: "from flask import Flask, jsonify\nimport psycopg2\nimport redis\nimport os\n\napp = Flask(__name__)\n\ndef get_db_connection():\n    return psycopg2.connect(\n        host=os.getenv(\"DB_HOST\"\
  , \"db\"),\n        database=os.getenv(\"DB_NAME\", \"app\"),\n        user=os.getenv(\"DB_USER\", \"postgres\"),\n        password=os.getenv(\"DB_PASSWORD\", \"secret\")\n    )\n\ndef get_redis_client():\n\
  \    return redis.Redis(\n        host=os.getenv(\"REDIS_HOST\", \"redis\"),\n        port=int(os.getenv(\"REDIS_PORT\", \"6379\")),\n        decode_responses=True\n    )\n\n@app.route('/health')\ndef\
  \ health():\n    return jsonify(status='ok')\n\n@app.route('/db-check')\ndef db_check():\n    conn = get_db_connection()\n    cursor = conn.cursor()\n    cursor.execute('SELECT 1')\n    conn.close()\n\
  \    return jsonify(db='connected')\n\n@app.route('/redis-check')\ndef redis_check():\n    client = get_redis_client()\n    client.ping()\n    return jsonify(redis='connected')\n"
src/worker.py: "import time\nfrom app import get_db_connection, get_redis_client\n\ndef process_queue():\n    redis_client = get_redis_client()\n    db_conn = get_db_connection()\n\n    while True:\n  \
  \      job = redis_client.lpop('jobs')\n        if job:\n            print(f\"Processing job: {job}\")\n        time.sleep(1)\n\nif __name__ == \"__main__\":\n    process_queue()\n"
requirements.txt: 'flask==2.3.0

  psycopg2-binary==2.9.9

  redis==5.0.0

  gunicorn==21.2.0

  '
Dockerfile: 'FROM python:3.12-slim

  WORKDIR /app

  COPY requirements.txt .

  RUN pip install -r requirements.txt

  COPY src/ ./src/

  CMD ["gunicorn", "-b", "0.0.0.0:8080", "src.app:app"]

  '
docker-compose.yml: "version: '3.8'\n\nservices:\n  web:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    ports:\n      - \"8080:8080\"\n    environment:\n      - DB_HOST=db\n      - DB_NAME=app\n\
  \      - DB_USER=postgres\n      - DB_PASSWORD=secret\n      - REDIS_HOST=redis\n    depends_on:\n      db:\n        condition: service_healthy\n        restart: true\n      redis:\n        condition:\
  \ service_healthy\n      migrations:\n        condition: service_completed_successfully\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8080/health\"]\n      interval: 30s\n\
  \      timeout: 10s\n      retries: 3\n      start_period: 40s\n    restart: unless-stopped\n\n  worker:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    command: [\"python\", \"src/worker.py\"\
  ]\n    environment:\n      - DB_HOST=db\n      - REDIS_HOST=redis\n    depends_on:\n      web:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n\n  db:\n    image:\
  \ postgres:16-alpine\n    environment:\n      POSTGRES_USER: postgres\n      POSTGRES_PASSWORD: secret\n      POSTGRES_DB: app\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    healthcheck:\n\
  \      test: [\"CMD-SHELL\", \"pg_isready -U postgres\"]\n      interval: 5s\n      timeout: 5s\n      retries: 5\n      start_period: 10s\n\n  redis:\n    image: redis:7-alpine\n    command: redis-server\
  \ --appendonly yes\n    volumes:\n      - redis_data:/data\n    healthcheck:\n      test: [\"CMD\", \"redis-cli\", \"ping\"]\n      interval: 5s\n      timeout: 3s\n      retries: 3\n\n  migrations:\n\
  \    build:\n      context: .\n      dockerfile: Dockerfile\n    command: [\"python\", \"-c\", \"print('Migrations completed')\"]\n    environment:\n      - DB_HOST=db\n    depends_on:\n      db:\n  \
  \      condition: service_healthy\n\nvolumes:\n  postgres_data:\n  redis_data:\n"
scripts/wait_for_deps.sh: '#!/bin/bash

  until pg_isready; do sleep 1; done

  '
tests/test_deps.py: "def test_dependency_order():\n    pass\n"
docs/services.md: '# Service Dependencies

  '
k8s/deployment.yaml: 'apiVersion: apps/v1

  '
helm/templates/deployment.yaml: ''
