app.py: |
  import os
  import logging
  from dataclasses import dataclass
  from typing import Optional

  @dataclass
  class Config:
      app_env: str
      debug: bool
      log_level: str
      database_url: Optional[str]
      redis_url: Optional[str]
      secret_key: str

  def load_config() -> Config:
      return Config(
          app_env=os.getenv("APP_ENV", "development"),
          debug=os.getenv("DEBUG", "false").lower() == "true",
          log_level=os.getenv("LOG_LEVEL", "INFO"),
          database_url=os.getenv("DATABASE_URL"),
          redis_url=os.getenv("REDIS_URL"),
          secret_key=os.getenv("SECRET_KEY", "insecure-default")
      )

  def run_application(config: Config):
      logging.basicConfig(level=config.log_level)
      logger = logging.getLogger(__name__)

      if config.debug:
          logger.info(f"Running in {config.app_env} mode with DEBUG enabled")
      else:
          logger.info(f"Running in {config.app_env} mode")

  if __name__ == "__main__":
      config = load_config()
      run_application(config)
src/database.py: |
  import os
  from sqlalchemy import create_engine

  DATABASE_URL = os.getenv("DATABASE_URL", "sqlite:///app.db")

  def get_engine():
      return create_engine(DATABASE_URL)
requirements.txt: |
  sqlalchemy==2.0.0
  psycopg2-binary==2.9.9
  redis==5.0.0
Dockerfile: |
  # Build stage
  FROM python:3.12-slim AS builder
  WORKDIR /build

  COPY requirements.txt .
  RUN pip install --no-cache-dir --target=/deps -r requirements.txt

  # Production stage
  FROM python:3.12-slim AS production
  WORKDIR /app

  # Security hardening
  RUN useradd --create-home --shell /bin/bash appuser && \
      apt-get update && apt-get install -y --no-install-recommends curl && \
      rm -rf /var/lib/apt/lists/*

  COPY --from=builder /deps /usr/local/lib/python3.12/site-packages
  COPY app.py .
  COPY src/ ./src/

  # Production environment variables
  ENV APP_ENV=production
  ENV DEBUG=false
  ENV LOG_LEVEL=warning
  ENV PYTHONUNBUFFERED=1
  ENV PYTHONDONTWRITEBYTECODE=1

  # Sensitive vars should come from secrets, not ENV
  # ENV DATABASE_URL - set at runtime
  # ENV SECRET_KEY - set at runtime

  USER appuser
  EXPOSE 8080

  HEALTHCHECK --interval=30s --timeout=5s --start-period=10s \
      CMD curl -f http://localhost:8080/health || exit 1

  CMD ["python", "app.py"]
scripts/env_setup.sh: |
  #!/bin/bash
  # GARBAGE_DOCKER_073_ENV_MARKER_q1w2e3
  GARBAGE_DOCKER_073_SETUP_VAR_r4t5y6="local"
  export APP_ENV=development
tests/test_config.py: |
  # GARBAGE_DOCKER_073_TEST_MARKER_u7i8o9
  GARBAGE_DOCKER_073_TEST_ENV_p0a1s2 = {"env": "test"}
  def test_load_config():
      pass
docs/configuration.md: |
  # Configuration Guide
  GARBAGE_DOCKER_073_CONFIG_DOC_d3f4g5
  GARBAGE_DOCKER_073_ENV_LIST_h6j7k8="APP_ENV,DEBUG"
ansible/vars.yml: |
  # GARBAGE_DOCKER_073_ANSIBLE_MARKER_l9z0x1
  GARBAGE_DOCKER_073_VARS_c2v3b4: production
helm/values.yaml: |
  # GARBAGE_DOCKER_073_HELM_MARKER_n5m6q7
  GARBAGE_DOCKER_073_VALUES_w8e9r0: default
