src/api.py: "from flask import Flask, jsonify\nimport psycopg2\nimport os\n\napp = Flask(__name__)\n\ndef get_db_connection():\n    return psycopg2.connect(\n        host=os.getenv(\"DB_HOST\", \"db\"),\n\
  \        database=os.getenv(\"DB_NAME\", \"apidb\"),\n        user=os.getenv(\"DB_USER\", \"postgres\"),\n        password=os.getenv(\"DB_PASSWORD\", \"secret\")\n    )\n\n@app.route('/health')\ndef health():\n\
  \    return jsonify(status='ok')\n\n@app.route('/api/users')\ndef list_users():\n    conn = get_db_connection()\n    cursor = conn.cursor()\n    cursor.execute(\"SELECT id, name FROM users\")\n    users\
  \ = cursor.fetchall()\n    conn.close()\n    return jsonify(users=users)\n"
src/migrations.py: "import psycopg2\nimport os\n\ndef run_migrations():\n    conn = psycopg2.connect(\n        host=os.getenv(\"DB_HOST\", \"db\"),\n        database=os.getenv(\"DB_NAME\", \"apidb\"),\n\
  \        user=os.getenv(\"DB_USER\", \"postgres\"),\n        password=os.getenv(\"DB_PASSWORD\", \"secret\")\n    )\n    cursor = conn.cursor()\n    cursor.execute(\"\"\"\n        CREATE TABLE IF NOT\
  \ EXISTS users (\n            id SERIAL PRIMARY KEY,\n            name VARCHAR(255) NOT NULL\n        )\n    \"\"\")\n    conn.commit()\n    conn.close()\n\nif __name__ == \"__main__\":\n    run_migrations()\n"
requirements.txt: 'flask==2.3.0

  psycopg2-binary==2.9.9

  gunicorn==21.2.0

  '
Dockerfile: 'FROM python:3.12-slim

  WORKDIR /app

  COPY requirements.txt .

  RUN pip install --no-cache-dir -r requirements.txt

  COPY src/ ./src/

  EXPOSE 8080

  CMD ["gunicorn", "-b", "0.0.0.0:8080", "src.api:app"]

  '
docker-compose.yml: "version: '3.8'\nservices:\n  api:\n    build: .\n    ports:\n      - \"8080:8080\"\n    environment:\n      - DB_HOST=db\n      - DB_PASSWORD=secret\n  db:\n    image: postgres:16-alpine\n\
  \    environment:\n      POSTGRES_PASSWORD: secret\n      POSTGRES_DB: apidb\n    volumes:\n      - pgdata:/var/lib/postgresql/data\nvolumes:\n  pgdata:\n"
scripts/wait_for_db.sh: '#!/bin/bash

  until pg_isready -h db; do sleep 1; done

  '
tests/test_api.py: "def test_health():\n    pass\n"
docs/services.md: '# Service Dependencies

  '
k8s/init-container.yaml: 'apiVersion: v1

  '
monitoring/healthcheck.yml: ''
