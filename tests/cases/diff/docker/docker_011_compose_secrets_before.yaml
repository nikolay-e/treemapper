src/app.py: |
  from flask import Flask, jsonify
  import os

  app = Flask(__name__)

  def get_db_password():
      with open("/run/secrets/db_password") as f:
          return f.read().strip()

  def create_db_url():
      password = get_db_password()
      host = os.getenv("DB_HOST", "db")
      return f"postgresql://app:{password}@{host}:5432/appdb"

  @app.route('/health')
  def health():
      return jsonify(status='ok')

  @app.route('/api/data')
  def get_data():
      db_url = create_db_url()
      return jsonify(db_url_configured=bool(db_url))

  if __name__ == "__main__":
      app.run(host="0.0.0.0", port=8080)
src/config.py: |
  import os

  def get_db_password():
      with open("/run/secrets/db_password") as f:
          return f.read().strip()

  DB_HOST = os.getenv("DB_HOST", "db")
  DB_PORT = int(os.getenv("DB_PORT", "5432"))
  DB_NAME = os.getenv("DB_NAME", "appdb")
requirements.txt: |
  flask==2.3.0
  gunicorn==21.2.0
  psycopg2-binary==2.9.9
Dockerfile: |
  FROM python:3.12-slim
  WORKDIR /app
  COPY requirements.txt .
  RUN pip install --no-cache-dir -r requirements.txt
  COPY src/ ./src/
  USER nobody
  EXPOSE 8080
  CMD ["gunicorn", "-b", "0.0.0.0:8080", "src.app:app"]
docker-compose.yml: |
  version: '3.8'
  services:
    app:
      build: .
      ports:
        - "8080:8080"
      environment:
        - DB_HOST=db
      secrets:
        - db_password
      depends_on:
        - db
    db:
      image: postgres:16-alpine
      environment:
        POSTGRES_PASSWORD_FILE: /run/secrets/db_password
        POSTGRES_DB: appdb
      secrets:
        - db_password
      volumes:
        - pgdata:/var/lib/postgresql/data
  secrets:
    db_password:
      file: ./secrets/db_password.txt
  volumes:
    pgdata:
scripts/rotate_secrets.sh: |
  #!/bin/bash
  # GARBAGE_DOCK_011_ROTATE_SCRIPT_A
  GARBAGE_DOCK_011_ROTATE_INTERVAL_B="86400"
  echo "Rotating secrets..."
tests/test_secrets.py: |
  # GARBAGE_DOCK_011_SECRET_TEST_A
  GARBAGE_DOCK_011_TEST_VAULT_B = "vault://secret/data"
  def test_secret_loading():
      pass
docs/security.md: |
  # Security Guide
  GARBAGE_DOCK_011_SECURITY_DOC_A
  GARBAGE_DOCK_011_ENCRYPTION_KEY_B="AES256"
k8s/sealed-secret.yaml: |
  # GARBAGE_DOCK_011_K8S_SEALED_A
  apiVersion: bitnami.com/v1alpha1
  GARBAGE_DOCK_011_SEALED_KIND_B: SealedSecret
monitoring/alerts.yml: |
  # GARBAGE_DOCK_011_ALERT_MARKER_A
  GARBAGE_DOCK_011_ALERT_THRESHOLD_B: 95
