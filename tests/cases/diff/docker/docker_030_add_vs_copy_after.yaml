src/app.py: |
  import os
  import tarfile
  from pathlib import Path

  ASSETS_DIR = Path('/app/assets')
  CONFIG_DIR = Path('/app/config')

  def extract_assets():
      if ASSETS_DIR.exists():
          print(f"Assets loaded: {list(ASSETS_DIR.iterdir())}")

  def load_config():
      config_file = CONFIG_DIR / 'app.json'
      if config_file.exists():
          return config_file.read_text()
      return '{}'
assets.tar.gz: |
  (binary tarball placeholder)
requirements.txt: |
  flask==2.3.0
Dockerfile: |
  FROM python:3.12-slim-bookworm AS base
  ENV PYTHONDONTWRITEBYTECODE=1
  ENV PYTHONUNBUFFERED=1

  FROM base AS dependencies
  WORKDIR /app
  COPY requirements.txt .
  RUN pip install --no-cache-dir -r requirements.txt

  FROM base AS production
  WORKDIR /app

  # ADD automatically extracts tar archives
  ADD assets.tar.gz /app/assets/

  # ADD can fetch remote URLs (use with caution - prefer COPY for local files)
  ADD --checksum=sha256:abc123def456 https://releases.example.com/config/v1.0/defaults.json /app/config/defaults.json

  # COPY for regular files (preferred over ADD for non-archives)
  COPY --from=dependencies /usr/local/lib/python3.12/site-packages /usr/local/lib/python3.12/site-packages
  COPY --from=dependencies /usr/local/bin /usr/local/bin
  COPY src/ ./src/

  RUN useradd --create-home appuser && \
      chown -R appuser:appuser /app
  USER appuser

  CMD ["python", "src/app.py"]
scripts/prepare_assets.sh: |
  #!/bin/bash
  # GARBAGE_DOCKER_515_ASSETS_MARKER_001
  GARBAGE_DOCKER_515_ASSETS_VAR_002="prepare"
  tar -czf assets.tar.gz assets/
tests/test_assets.py: |
  # GARBAGE_DOCKER_515_TEST_MARKER_003
  GARBAGE_DOCKER_515_TEST_ASSETS_004 = {"path": "/app/assets"}
  def test_assets_loaded():
      pass
docs/assets.md: |
  # Asset Management
  GARBAGE_DOCKER_515_ASSET_DOC_005
  GARBAGE_DOCKER_515_BUNDLE_006="assets.tar.gz"
cdn/config.yaml: |
  # GARBAGE_DOCKER_515_CDN_MARKER_007
  GARBAGE_DOCKER_515_CDN_VAR_008: cloudfront
build/checksums.txt: |
  # GARBAGE_DOCKER_515_CHECKSUM_MARKER_009
  GARBAGE_DOCKER_515_SHA256_010="abc123"
