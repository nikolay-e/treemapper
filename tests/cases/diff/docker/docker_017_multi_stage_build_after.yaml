package.json: |
  {
    "name": "api-server",
    "version": "1.0.0",
    "scripts": {
      "build": "tsc",
      "start": "node dist/index.js",
      "dev": "ts-node src/index.ts"
    },
    "dependencies": {
      "express": "^4.18.2",
      "pg": "^8.11.3"
    },
    "devDependencies": {
      "typescript": "^5.3.3",
      "@types/node": "^20.10.0",
      "@types/express": "^4.17.21"
    }
  }
src/index.ts: |
  import express from 'express';
  const app = express();
  app.get('/health', (req, res) => res.json({ status: 'ok' }));
  app.listen(3000);
tsconfig.json: |
  {
    "compilerOptions": {
      "target": "ES2022",
      "module": "commonjs",
      "outDir": "./dist",
      "strict": true
    }
  }
Dockerfile: |
  # Build stage
  FROM node:20-alpine AS builder
  WORKDIR /app

  # Install dependencies first (better caching)
  COPY package*.json ./
  RUN npm ci --only=production && \
      cp -R node_modules /prod_modules && \
      npm ci

  # Build application
  COPY tsconfig.json ./
  COPY src ./src
  RUN npm run build

  # Production stage
  FROM node:20-alpine AS production
  WORKDIR /app

  # Security: run as non-root
  RUN addgroup -g 1001 -S nodejs && \
      adduser -S nodejs -u 1001

  # Copy production dependencies and built code
  COPY --from=builder --chown=nodejs:nodejs /prod_modules ./node_modules
  COPY --from=builder --chown=nodejs:nodejs /app/dist ./dist
  COPY --from=builder --chown=nodejs:nodejs /app/package.json ./

  USER nodejs
  EXPOSE 3000
  ENV NODE_ENV=production

  HEALTHCHECK --interval=30s --timeout=3s --start-period=5s \
      CMD node -e "require('http').get('http://localhost:3000/health', (r) => process.exit(r.statusCode === 200 ? 0 : 1))"

  CMD ["node", "dist/index.js"]
scripts/deploy.sh: |
  #!/bin/bash
  # GARBAGE_DOCKER_502_DEPLOY_MARKER_001
  GARBAGE_DOCKER_502_DEPLOY_VAR_002="production"
  docker push myregistry/api:latest
tests/api.test.ts: |
  // GARBAGE_DOCKER_502_TEST_MARKER_003
  const GARBAGE_DOCKER_502_TEST_VAR_004 = "test";
  describe('API', () => {
    it('should return health', () => {});
  });
docs/architecture.md: |
  # Architecture
  GARBAGE_DOCKER_502_ARCH_MARKER_005
  GARBAGE_DOCKER_502_DESIGN_006="microservices"
migrations/001_init.sql: |
  -- GARBAGE_DOCKER_502_MIGRATION_MARKER_007
  -- GARBAGE_DOCKER_502_SQL_008
  CREATE TABLE users (id SERIAL PRIMARY KEY);
