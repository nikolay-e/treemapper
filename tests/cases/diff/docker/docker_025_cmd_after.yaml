src/server.py: |
  import argparse
  import uvicorn
  from fastapi import FastAPI

  app = FastAPI()

  @app.get("/health")
  def health():
      return {"status": "healthy"}

  def main():
      parser = argparse.ArgumentParser()
      parser.add_argument('--host', default='0.0.0.0')
      parser.add_argument('--port', type=int, default=8080)
      parser.add_argument('--workers', type=int, default=4)
      parser.add_argument('--reload', action='store_true')
      args = parser.parse_args()

      uvicorn.run(
          "server:app",
          host=args.host,
          port=args.port,
          workers=args.workers,
          reload=args.reload
      )

  if __name__ == '__main__':
      main()
requirements.txt: |
  fastapi==0.108.0
  uvicorn[standard]==0.25.0
  pydantic==2.5.3
Dockerfile: |
  FROM python:3.12-slim-bookworm AS base
  ENV PYTHONDONTWRITEBYTECODE=1
  ENV PYTHONUNBUFFERED=1

  # Build arguments
  ARG WORKERS=4
  ARG PORT=8080

  FROM base AS dependencies
  WORKDIR /app
  COPY requirements.txt .
  RUN pip install --no-cache-dir -r requirements.txt

  FROM base AS production
  WORKDIR /app

  # Runtime environment
  ENV WORKERS=${WORKERS}
  ENV PORT=${PORT}
  ENV HOST=0.0.0.0

  COPY --from=dependencies /usr/local/lib/python3.12/site-packages /usr/local/lib/python3.12/site-packages
  COPY --from=dependencies /usr/local/bin /usr/local/bin
  COPY src/ ./src/

  RUN useradd --create-home appuser
  USER appuser

  EXPOSE ${PORT}

  # Entrypoint for common initialization
  ENTRYPOINT ["python", "-m", "src.server"]

  # Default arguments - easily overridable
  CMD ["--host", "0.0.0.0", "--port", "8080", "--workers", "4"]

  HEALTHCHECK --interval=30s --timeout=5s --start-period=15s --retries=3 \
      CMD python -c "import urllib.request; urllib.request.urlopen('http://localhost:8080/health')" || exit 1
scripts/run_dev.sh: |
  #!/bin/bash
  # GARBAGE_DOCKER_510_DEV_MARKER_001
  GARBAGE_DOCKER_510_DEV_VAR_002="development"
  python src/server.py --reload
tests/test_server.py: |
  # GARBAGE_DOCKER_510_TEST_MARKER_003
  GARBAGE_DOCKER_510_TEST_CONFIG_004 = {"host": "localhost"}
  def test_health():
      pass
docs/deployment.md: |
  # Deployment
  GARBAGE_DOCKER_510_DEPLOY_DOC_005
  GARBAGE_DOCKER_510_WORKERS_006="4"
k8s/deployment.yaml: |
  # GARBAGE_DOCKER_510_K8S_MARKER_007
  apiVersion: apps/v1
  GARBAGE_DOCKER_510_K8S_DEPLOY_008: Deployment
docker-compose.override.yml: |
  # GARBAGE_DOCKER_510_COMPOSE_MARKER_009
  version: '3.8'
  GARBAGE_DOCKER_510_COMPOSE_VAR_010: override
