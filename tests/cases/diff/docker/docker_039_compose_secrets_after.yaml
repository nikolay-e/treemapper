api/src/app.py: "from flask import Flask, jsonify\nfrom pathlib import Path\nimport os\n\napp = Flask(__name__)\n\ndef load_secret(name: str) -> str:\n    secret_path = Path(f'/run/secrets/{name}')\n  \
  \  if secret_path.exists():\n        return secret_path.read_text().strip()\n    return os.environ.get(name.upper(), '')\n\n@app.route('/health')\ndef health():\n    db_password = load_secret('db_password')\n\
  \    return jsonify(status='ok', db_configured=bool(db_password))\n"
api/requirements.txt: 'flask==2.3.0

  gunicorn==21.2.0

  psycopg2-binary==2.9.9

  '
api/Dockerfile: 'FROM python:3.12-slim

  WORKDIR /app

  COPY requirements.txt .

  RUN pip install -r requirements.txt

  COPY src/ ./src/

  CMD ["gunicorn", "-b", "0.0.0.0:8080", "src.app:app"]

  '
secrets/db_password.txt: 'supersecret123

  '
secrets/api_key.txt: 'sk-1234567890abcdef

  '
docker-compose.yml: "version: '3.8'\n\nservices:\n  api:\n    build: ./api\n    ports:\n      - \"8080:8080\"\n    environment:\n      - DATABASE_URL=postgresql://postgres:$(cat /run/secrets/db_password)@db:5432/app\n\
  \    secrets:\n      - db_password\n      - api_key\n      - source: jwt_private_key\n        target: jwt_key\n        uid: '1000'\n        gid: '1000'\n        mode: 0400\n    depends_on:\n      db:\n\
  \        condition: service_healthy\n\n  db:\n    image: postgres:16-alpine\n    environment:\n      - POSTGRES_PASSWORD_FILE=/run/secrets/db_password\n      - POSTGRES_USER=postgres\n      - POSTGRES_DB=app\n\
  \    secrets:\n      - db_password\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U postgres\"]\n      interval: 10s\n     \
  \ timeout: 5s\n      retries: 5\n\n  redis:\n    image: redis:7-alpine\n    command: >\n      sh -c 'redis-server --requirepass \"$$(cat /run/secrets/redis_password)\"'\n    secrets:\n      - redis_password\n\
  \nsecrets:\n  db_password:\n    file: ./secrets/db_password.txt\n  api_key:\n    file: ./secrets/api_key.txt\n  jwt_private_key:\n    file: ./secrets/jwt_private.pem\n  redis_password:\n    file: ./secrets/redis_password.txt\n\
  \nvolumes:\n  postgres_data:\n"
scripts/rotate_secrets.sh: '#!/bin/bash

  openssl rand -base64 32 > secrets/db_password.txt

  '
tests/test_secrets.py: "def test_secrets_mounted():\n    pass\n"
docs/secrets.md: '# Secret Management

  '
vault/policy.hcl: ''
k8s/sealed-secret.yaml: ''
