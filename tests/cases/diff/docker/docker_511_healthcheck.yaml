name: docker_511_healthcheck
initial:
  app.py: |
    from flask import Flask
    app = Flask(__name__)

    @app.route('/health')
    def health():
        return 'OK', 200

    if __name__ == '__main__':
        app.run(host='0.0.0.0', port=8080)
  Dockerfile: |
    FROM python:3.11-slim
    COPY app.py .
    RUN pip install flask
    CMD ["python", "app.py"]
  junk.py: |
    garbage_marker_12345 = 1
    unused_marker_67890 = 2
changed:
  Dockerfile: |
    FROM python:3.11-slim
    COPY app.py .
    RUN pip install flask
    HEALTHCHECK --interval=30s --timeout=3s --start-period=5s \
        CMD curl -f http://localhost:8080/health || exit 1
    CMD ["python", "app.py"]
assertions:
  must_include:
  - HEALTHCHECK
  must_not_include:
  - garbage_marker_12345
  - unused_marker_67890
options:
  commit_message: Add HEALTHCHECK
