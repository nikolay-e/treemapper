name: tf_046_ecs_task_definition
initial:
  ecs.tf: |
    resource "aws_ecs_task_definition" "app" {
      family = "app"
      container_definitions = jsonencode([{
        name  = "app"
        image = "myapp:latest"
        portMappings = [{
          containerPort = 8080
        }]
      }])
    }
  src/server.py: |
    from flask import Flask
    app = Flask(__name__)

    @app.route("/health")
    def health():
        return "OK"
changed:
  ecs.tf: |
    resource "aws_ecs_task_definition" "app" {
      family = "app"
      cpu    = "256"
      memory = "512"
      container_definitions = jsonencode([{
        name  = "app"
        image = "myapp:v2"
        portMappings = [{
          containerPort = 8080
        }]
      }])
    }
assertions:
  must_include:
    - Flask
options:
  commit_message: update ecs task
