name: tf_052_sns_topic
initial:
  sns.tf: |
    resource "aws_sns_topic" "alerts" {
      name = "alert-notifications"
    }
  src/notifications.py: |
    import boto3

    def publish_alert(topic_arn: str, message: str):
        sns = boto3.client("sns")
        sns.publish(TopicArn=topic_arn, Message=message)
changed:
  sns.tf: |
    resource "aws_sns_topic" "alerts" {
      name         = "alert-notifications"
      display_name = "System Alerts"
    }

    resource "aws_sns_topic_subscription" "email" {
      topic_arn = aws_sns_topic.alerts.arn
      protocol  = "email"
      endpoint  = "alerts@example.com"
    }
assertions:
  must_include:
    - publish_alert
options:
  commit_message: add email subscription
