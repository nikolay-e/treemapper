modules/dynamodb/main.tf: |
  resource "aws_dynamodb_table" "this" {
    name           = var.table_name
    billing_mode   = var.billing_mode
    hash_key       = var.hash_key
    range_key      = var.range_key

    dynamic "attribute" {
      for_each = var.attributes
      content {
        name = attribute.value.name
        type = attribute.value.type
      }
    }

    dynamic "global_secondary_index" {
      for_each = var.global_secondary_indexes
      content {
        name               = global_secondary_index.value.name
        hash_key           = global_secondary_index.value.hash_key
        range_key          = global_secondary_index.value.range_key
        projection_type    = global_secondary_index.value.projection_type
        non_key_attributes = global_secondary_index.value.non_key_attributes
      }
    }

    point_in_time_recovery {
      enabled = var.point_in_time_recovery_enabled
    }

    server_side_encryption {
      enabled     = var.encryption_enabled
      kms_key_arn = var.kms_key_arn
    }

    ttl {
      attribute_name = var.ttl_attribute_name
      enabled        = var.ttl_enabled
    }

    tags = var.tags
  }
modules/dynamodb/variables.tf: |
  variable "table_name" {
    type = string
  }

  variable "billing_mode" {
    type    = string
    default = "PAY_PER_REQUEST"
  }

  variable "hash_key" {
    type = string
  }

  variable "range_key" {
    type    = string
    default = null
  }

  variable "attributes" {
    type = list(object({
      name = string
      type = string
    }))
  }

  variable "global_secondary_indexes" {
    type    = list(any)
    default = []
  }

  variable "point_in_time_recovery_enabled" {
    type    = bool
    default = true
  }

  variable "encryption_enabled" {
    type    = bool
    default = true
  }

  variable "kms_key_arn" {
    type    = string
    default = null
  }

  variable "ttl_attribute_name" {
    type    = string
    default = ""
  }

  variable "ttl_enabled" {
    type    = bool
    default = false
  }

  variable "tags" {
    type    = map(string)
    default = {}
  }
app.py: |
  import boto3
  dynamodb = boto3.resource('dynamodb')
  table = dynamodb.Table('users')
  table.put_item(Item={'user_id': '123', 'name': 'John'})
infrastructure/database.tf: |
  module "users_table" {
    source     = "./modules/dynamodb"
    table_name = "users-${var.environment}"
    hash_key   = "user_id"

    attributes = [
      { name = "user_id", type = "S" }
    ]

    tags = local.common_tags
  }
unrelated/redshift.tf: |
  # GARBAGE_TF_REDSHIFT_446_001
  resource "aws_redshift_cluster" "unrelated_cluster" {
    cluster_identifier = "GARBAGE-REDSHIFT-446-002"
    database_name      = "GARBAGE_DB_446_003"
    master_username    = "admin"
    master_password    = "GARBAGE_PASSWORD_446_004"
    node_type          = "dc2.large"
    cluster_type       = "single-node"
  }
unrelated/neptune.tf: |
  # GARBAGE_TF_NEPTUNE_446_005
  resource "aws_neptune_cluster" "unrelated_neptune" {
    cluster_identifier = "GARBAGE-NEPTUNE-446-006"
    engine             = "neptune"
    skip_final_snapshot = true
  }

  resource "aws_neptune_cluster_instance" "unrelated_instance" {
    count              = 1
    cluster_identifier = aws_neptune_cluster.unrelated_neptune.id
    instance_class     = "db.t3.medium"
    identifier         = "GARBAGE-NEPTUNE-INSTANCE-446-007"
  }
