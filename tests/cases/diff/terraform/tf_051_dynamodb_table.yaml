name: tf_051_dynamodb_table
initial:
  dynamodb.tf: |
    resource "aws_dynamodb_table" "users" {
      name         = "users"
      billing_mode = "PAY_PER_REQUEST"
      hash_key     = "id"

      attribute {
        name = "id"
        type = "S"
      }
    }
  src/users.py: |
    import boto3

    def get_user(user_id: str):
        dynamodb = boto3.resource("dynamodb")
        table = dynamodb.Table("users")
        return table.get_item(Key={"id": user_id})
changed:
  dynamodb.tf: |
    resource "aws_dynamodb_table" "users" {
      name         = "users"
      billing_mode = "PAY_PER_REQUEST"
      hash_key     = "id"
      range_key    = "created_at"

      attribute {
        name = "id"
        type = "S"
      }

      attribute {
        name = "created_at"
        type = "N"
      }
    }
assertions:
  must_include:
    - get_user
options:
  commit_message: add range key
