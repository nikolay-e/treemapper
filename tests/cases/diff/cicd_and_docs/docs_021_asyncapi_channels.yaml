name: docs_021_asyncapi_channels
initial:
  asyncapi.yaml: |
    asyncapi: 2.6.0
    info:
      title: Order Events
      version: 1.0.0
    channels:
      orders/created:
        publish:
          message:
            payload:
              type: object
              properties:
                orderId:
                  type: string
  src/events/order_publisher.py: |
    def publish_order_created(order_id):
        publish('orders/created', {'orderId': order_id})
changed:
  asyncapi.yaml: |
    asyncapi: 2.6.0
    info:
      title: Order Events
      version: 1.0.0
    channels:
      orders/created:
        publish:
          message:
            payload:
              $ref: '#/components/schemas/OrderCreatedEvent'
      orders/updated:
        publish:
          message:
            payload:
              $ref: '#/components/schemas/OrderUpdatedEvent'
      orders/shipped:
        subscribe:
          message:
            payload:
              $ref: '#/components/schemas/OrderShippedEvent'
    components:
      schemas:
        OrderCreatedEvent:
          type: object
          properties:
            orderId:
              type: string
            userId:
              type: string
            timestamp:
              type: string
              format: date-time
        OrderUpdatedEvent:
          type: object
          properties:
            orderId:
              type: string
            changes:
              type: object
        OrderShippedEvent:
          type: object
          properties:
            orderId:
              type: string
            trackingNumber:
              type: string
assertions:
  must_include:
  - asyncapi.yaml
  must_not_include:
  - garbage_marker_12345
  - unused_marker_67890
