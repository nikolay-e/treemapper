name: docs_027_sql_migration_adds_index
initial:
  migrations/001_create_products.sql: |
    CREATE TABLE products (
        id SERIAL PRIMARY KEY,
        name VARCHAR(255) NOT NULL,
        category VARCHAR(100),
        price DECIMAL(10, 2)
    );
  src/repository/product_repository.py: |
    class ProductRepository:
        def find_by_category(self, category: str):
            return self.db.query(
                "SELECT * FROM products WHERE category = %s", [category]
            )
changed:
  migrations/002_add_product_indexes.sql: |
    CREATE INDEX idx_products_category ON products(category);
    CREATE INDEX idx_products_price ON products(price);
    CREATE INDEX idx_products_name_search ON products USING gin(to_tsvector('english', name));
assertions:
  must_include:
  - 002_add_product_indexes.sql
  must_not_include:
  - garbage_marker_12345
  - unused_marker_67890
