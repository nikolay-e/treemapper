name: docs_023_swagger_security
initial:
  swagger.yaml: |
    swagger: "2.0"
    info:
      title: API
      version: 1.0.0
    securityDefinitions:
      apiKey:
        type: apiKey
        in: header
        name: X-API-Key
    paths:
      /users:
        get:
          security:
            - apiKey: []
          responses:
            200:
              description: Success
  src/middleware/auth.py: |
    def require_api_key(func):
        def wrapper(*args, **kwargs):
            api_key = request.headers.get('X-API-Key')
            if not api_key:
                return {'error': 'API key required'}, 401
            return func(*args, **kwargs)
        return wrapper
changed:
  swagger.yaml: |
    swagger: "2.0"
    info:
      title: API
      version: 1.0.0
    securityDefinitions:
      apiKey:
        type: apiKey
        in: header
        name: X-API-Key
      oauth2:
        type: oauth2
        flow: accessCode
        authorizationUrl: https://auth.example.com/authorize
        tokenUrl: https://auth.example.com/token
        scopes:
          read:users: Read user data
          write:users: Modify user data
      bearerAuth:
        type: apiKey
        in: header
        name: Authorization
    paths:
      /users:
        get:
          security:
            - apiKey: []
            - oauth2: [read:users]
          responses:
            200:
              description: Success
            401:
              description: Unauthorized
assertions:
  must_include:
  - swagger.yaml
  must_not_include:
  - garbage_marker_12345
  - unused_marker_67890
