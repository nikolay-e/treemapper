name: docs_024_grpc_stream
initial:
  proto/stream.proto: |
    syntax = "proto3";

    package stream;

    service DataService {
        rpc GetData(GetDataRequest) returns (DataResponse);
    }

    message GetDataRequest {
        string id = 1;
    }

    message DataResponse {
        bytes data = 1;
    }
  src/grpc/stream_service.py: |
    class DataServiceServicer:
        def GetData(self, request, context):
            data = get_data(request.id)
            return DataResponse(data=data)
changed:
  proto/stream.proto: |
    syntax = "proto3";

    package stream;

    service DataService {
        rpc GetData(GetDataRequest) returns (DataResponse);
        rpc StreamData(GetDataRequest) returns (stream DataChunk);
        rpc UploadData(stream DataChunk) returns (UploadResponse);
        rpc BiDirectionalStream(stream DataChunk) returns (stream DataChunk);
    }

    message GetDataRequest {
        string id = 1;
    }

    message DataResponse {
        bytes data = 1;
    }

    message DataChunk {
        bytes content = 1;
        int64 offset = 2;
        bool is_last = 3;
    }

    message UploadResponse {
        string id = 1;
        int64 total_bytes = 2;
        bool success = 3;
    }
assertions:
  must_include:
  - stream.proto
  must_not_include:
  - garbage_marker_12345
  - unused_marker_67890
