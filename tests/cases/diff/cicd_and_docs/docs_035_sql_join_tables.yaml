name: docs_035_sql_join_tables
initial:
  sql/queries/order_details.sql: |
    SELECT
        o.id AS order_id,
        u.name AS customer_name,
        p.name AS product_name,
        oi.quantity,
        oi.price
    FROM orders o
    JOIN users u ON o.user_id = u.id
    JOIN order_items oi ON o.id = oi.order_id
    JOIN products p ON oi.product_id = p.id
    WHERE o.id = :order_id;
changed:
  sql/queries/order_details.sql: |
    SELECT
        o.id AS order_id,
        o.status,
        u.name AS customer_name,
        u.email AS customer_email,
        p.name AS product_name,
        c.name AS category_name,
        oi.quantity,
        oi.price,
        (oi.quantity * oi.price) AS line_total
    FROM orders o
    JOIN users u ON o.user_id = u.id
    JOIN order_items oi ON o.id = oi.order_id
    JOIN products p ON oi.product_id = p.id
    LEFT JOIN categories c ON p.category_id = c.id
    WHERE o.id = :order_id;
assertions:
  must_include:
  - order_details.sql
  must_not_include:
  - garbage_marker_12345
  - unused_marker_67890
