name: docs_019_protobuf_service
initial:
  proto/user_service.proto: |
    syntax = "proto3";

    package user;

    service UserService {
        rpc GetUser(GetUserRequest) returns (User);
    }

    message GetUserRequest {
        int64 id = 1;
    }

    message User {
        int64 id = 1;
        string name = 2;
    }
  src/grpc/user_service.py: |
    class UserServiceServicer:
        def GetUser(self, request, context):
            user = get_user(request.id)
            return User(id=user.id, name=user.name)
changed:
  proto/user_service.proto: |
    syntax = "proto3";

    package user;

    service UserService {
        rpc GetUser(GetUserRequest) returns (User);
        rpc ListUsers(ListUsersRequest) returns (ListUsersResponse);
        rpc CreateUser(CreateUserRequest) returns (User);
        rpc UpdateUser(UpdateUserRequest) returns (User);
        rpc DeleteUser(DeleteUserRequest) returns (DeleteUserResponse);
    }

    message GetUserRequest {
        int64 id = 1;
    }

    message ListUsersRequest {
        int32 page_size = 1;
        string page_token = 2;
    }

    message ListUsersResponse {
        repeated User users = 1;
        string next_page_token = 2;
    }

    message CreateUserRequest {
        string name = 1;
        string email = 2;
    }

    message UpdateUserRequest {
        int64 id = 1;
        string name = 2;
        string email = 3;
    }

    message DeleteUserRequest {
        int64 id = 1;
    }

    message DeleteUserResponse {
        bool success = 1;
    }

    message User {
        int64 id = 1;
        string name = 2;
        string email = 3;
    }
assertions:
  must_include:
  - user_service.proto
  must_not_include:
  - garbage_marker_12345
  - unused_marker_67890
