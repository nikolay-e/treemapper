name: cicd_089_gitlab_ci_script
initial:
  .gitlab-ci.yml: |
    stages:
      - build
      - test

    build:
      stage: build
      script:
        - npm run build
  src/main.ts: |
    export function main() {
      console.log("Main function");
    }
changed:
  .gitlab-ci.yml: |
    stages:
      - build
      - test
      - deploy

    build:
      stage: build
      script:
        - npm ci
        - npm run build
      artifacts:
        paths:
          - dist/

    test:
      stage: test
      script:
        - npm test
assertions:
  must_include:
    - npm
options:
  commit_message: add test stage
