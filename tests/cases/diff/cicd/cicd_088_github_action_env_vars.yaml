name: cicd_088_github_action_env_vars
initial:
  .github/workflows/deploy.yml: |
    name: Deploy
    on:
      push:
        branches: [main]
    jobs:
      deploy:
        runs-on: ubuntu-latest
        env:
          NODE_ENV: production
        steps:
          - run: npm run deploy
  deploy.js: |
    const env = process.env.NODE_ENV || 'development';
    console.log(`Deploying to ${env}`);
changed:
  .github/workflows/deploy.yml: |
    name: Deploy
    on:
      push:
        branches: [main]
    jobs:
      deploy:
        runs-on: ubuntu-latest
        env:
          NODE_ENV: production
          DEPLOY_TARGET: kubernetes
          AWS_REGION: us-east-1
        steps:
          - run: npm run deploy
assertions:
  must_include:
    - NODE_ENV
options:
  commit_message: add deploy vars
