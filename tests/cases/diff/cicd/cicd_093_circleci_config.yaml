name: cicd_093_circleci_config
initial:
  .circleci/config.yml: |
    version: 2.1
    jobs:
      build:
        docker:
          - image: cimg/python:3.11
        steps:
          - checkout
          - run: pip install .
          - run: pytest
  src/calculator.py: |
    def add(a: int, b: int) -> int:
        return a + b
changed:
  .circleci/config.yml: |
    version: 2.1
    jobs:
      build:
        docker:
          - image: cimg/python:3.12
        steps:
          - checkout
          - run: pip install -e .[dev]
          - run: pytest --cov
      deploy:
        docker:
          - image: cimg/python:3.12
        steps:
          - checkout
          - run: ./deploy.sh
    workflows:
      main:
        jobs:
          - build
          - deploy:
              requires:
                - build
assertions:
  must_include:
    - add
options:
  commit_message: add deploy job
