name: cicd_096_bitbucket_pipelines
initial:
  bitbucket-pipelines.yml: |
    pipelines:
      default:
        - step:
            name: Build
            script:
              - npm run build
  src/index.js: |
    function main() {
      console.log("Hello");
    }
changed:
  bitbucket-pipelines.yml: |
    image: node:20

    pipelines:
      default:
        - step:
            name: Build and Test
            caches:
              - node
            script:
              - npm ci
              - npm run build
              - npm test
      branches:
        main:
          - step:
              name: Deploy
              deployment: production
              script:
                - ./deploy.sh
assertions:
  must_include:
    - main
options:
  commit_message: add deploy pipeline
