k8s/base/deployment.yaml: |
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: stateful-web-app
    namespace: production
    labels:
      app: stateful-web-app
      tier: frontend
  spec:
    replicas: 5
    selector:
      matchLabels:
        app: stateful-web-app
    template:
      metadata:
        labels:
          app: stateful-web-app
          tier: frontend
      spec:
        containers:
        - name: webapp
          image: registry.example.com/stateful-web-app:v2.5.0
          ports:
          - containerPort: 8080
            name: http
          - containerPort: 8443
            name: https
          env:
          - name: SESSION_STORE
            value: "memory"
          - name: SESSION_TIMEOUT
            value: "3600"
          volumeMounts:
          - name: session-data
            mountPath: /app/sessions
          resources:
            requests:
              memory: "512Mi"
              cpu: "500m"
            limits:
              memory: "1Gi"
              cpu: "1000m"
        volumes:
        - name: session-data
          emptyDir: {}
k8s/base/service.yaml: |
  apiVersion: v1
  kind: Service
  metadata:
    name: stateful-web-app
    namespace: production
    labels:
      app: stateful-web-app
  spec:
    selector:
      app: stateful-web-app
    ports:
    - name: http
      port: 80
      targetPort: 8080
    - name: https
      port: 443
      targetPort: 8443
k8s/base/ingress.yaml: |
  apiVersion: networking.k8s.io/v1
  kind: Ingress
  metadata:
    name: stateful-web-app
    namespace: production
    annotations:
      nginx.ingress.kubernetes.io/affinity: "cookie"
      nginx.ingress.kubernetes.io/session-cookie-name: "INGRESSCOOKIE"
  spec:
    ingressClassName: nginx
    rules:
    - host: app.example.com
      http:
        paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: stateful-web-app
              port:
                number: 80
k8s/base/pdb.yaml: |
  apiVersion: policy/v1
  kind: PodDisruptionBudget
  metadata:
    name: stateful-web-app-pdb
    namespace: production
  spec:
    minAvailable: 3
    selector:
      matchLabels:
        app: stateful-web-app
k8s/unrelated/session/redis-session-store.yaml: |
  # GARBAGE_K8S_440_REDIS_SESSION
  apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    name: GARBAGE_K8S_440_REDIS_SS
    namespace: session
  spec:
    serviceName: GARBAGE_K8S_440_REDIS_SVC
    replicas: GARBAGE_K8S_440_REDIS_REPLICAS
    selector:
      matchLabels:
        app: GARBAGE_K8S_440_REDIS_LABEL
    template:
      spec:
        containers:
        - name: redis
          image: GARBAGE_K8S_440_REDIS_IMAGE
k8s/unrelated/loadbalancer/haproxy-config.yaml: |
  # GARBAGE_K8S_440_HAPROXY
  apiVersion: v1
  kind: ConfigMap
  metadata:
    name: GARBAGE_K8S_440_HAPROXY_CM
    namespace: loadbalancer
  data:
    haproxy.cfg: GARBAGE_K8S_440_HAPROXY_CFG
    stick-tables: GARBAGE_K8S_440_STICK_TABLE
k8s/unrelated/sticky/traefik-sticky.yaml: |
  # GARBAGE_K8S_440_TRAEFIK_STICKY
  apiVersion: traefik.containo.us/v1alpha1
  kind: IngressRoute
  metadata:
    name: GARBAGE_K8S_440_STICKY_ROUTE
    namespace: traefik
  spec:
    routes:
    - match: GARBAGE_K8S_440_STICKY_MATCH
      services:
      - name: GARBAGE_K8S_440_STICKY_SVC
        sticky:
          cookie:
            name: GARBAGE_K8S_440_COOKIE_NAME
cypress/e2e/session.cy.ts: |
  // GARBAGE_K8S_440_CYPRESS
  describe('GARBAGE_K8S_440_TEST_SUITE', () => {
    it('GARBAGE_K8S_440_TEST_NAME', () => {
      cy.visit(GARBAGE_K8S_440_TEST_URL);
    });
  });
