name: k8s_419_lifecycle_hooks
initial:
  shutdown.sh: |
    #!/bin/bash
    echo "Graceful shutdown..."
    kill -SIGTERM $(cat /var/run/app.pid)
    sleep 10
  deployment.yaml: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: myapp
    spec:
      template:
        spec:
          containers:
          - name: app
            image: myapp:latest
  unrelated.txt: |
    garbage_marker_k8s419 = True
    unused_marker_k8s419 = False
changed:
  deployment.yaml: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: myapp
    spec:
      template:
        spec:
          containers:
          - name: app
            image: myapp:latest
            lifecycle:
              postStart:
                exec:
                  command: ["/bin/sh", "-c", "echo Started"]
              preStop:
                exec:
                  command: ["/bin/sh", "-c", "/shutdown.sh"]
assertions:
  must_include:
  - lifecycle
  must_not_include:
  - garbage_marker_k8s419
  - unused_marker_k8s419
options:
  commit_message: Add lifecycle hooks
