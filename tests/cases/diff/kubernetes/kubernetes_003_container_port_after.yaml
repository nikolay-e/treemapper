src/main.py: |
  from fastapi import FastAPI
  from prometheus_client import make_asgi_app

  app = FastAPI()
  metrics_app = make_asgi_app()

  @app.get("/")
  def root():
      return {"status": "ok"}

  @app.get("/health")
  def health():
      return {"healthy": True}

  if __name__ == "__main__":
      import uvicorn
      uvicorn.run(app, host="0.0.0.0", port=8080)
k8s/deployment.yaml: |
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: fastapi-app
    namespace: default
    labels:
      app: fastapi-app
      version: v1
  spec:
    replicas: 2
    selector:
      matchLabels:
        app: fastapi-app
    template:
      metadata:
        labels:
          app: fastapi-app
          version: v1
        annotations:
          prometheus.io/scrape: "true"
          prometheus.io/port: "9100"
      spec:
        containers:
        - name: app
          image: fastapi-app:latest
          ports:
          - containerPort: 8080
            name: http
            protocol: TCP
          env:
          - name: ENVIRONMENT
            value: "production"
          volumeMounts:
          - name: config
            mountPath: /app/config
        volumes:
        - name: config
          configMap:
            name: app-config
k8s/service.yaml: |
  apiVersion: v1
  kind: Service
  metadata:
    name: fastapi-app
    namespace: default
  spec:
    selector:
      app: fastapi-app
    ports:
    - name: http
      port: 80
      targetPort: 8080
      protocol: TCP
k8s/unrelated/database/postgres-statefulset.yaml: |
  # GARBAGE_K8S_403_POSTGRES_SS
  apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    name: GARBAGE_K8S_403_POSTGRES_CLUSTER
  spec:
    serviceName: GARBAGE_K8S_403_POSTGRES_SVC
    replicas: 3
    selector:
      matchLabels:
        app: GARBAGE_K8S_403_DB_LABEL
    template:
      spec:
        containers:
        - name: postgres
          image: postgres:GARBAGE_K8S_403_PG_VERSION
k8s/unrelated/cache/redis-deployment.yaml: |
  # GARBAGE_K8S_403_REDIS_CACHE
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: GARBAGE_K8S_403_REDIS_MASTER
  spec:
    replicas: 1
    template:
      spec:
        containers:
        - name: redis
          image: redis:GARBAGE_K8S_403_REDIS_TAG
          args: ["--requirepass", "GARBAGE_K8S_403_REDIS_PASS"]
