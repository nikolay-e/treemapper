name: k8s_406_secret_reference
initial:
  secret.yaml: |
    apiVersion: v1
    kind: Secret
    metadata:
      name: db-secret
    type: Opaque
    data:
      password: dGVzdA==
  deployment.yaml: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: myapp
    spec:
      template:
        spec:
          containers:
          - name: app
            env: []
  unrelated.txt: |
    garbage_marker_k8s406 = True
    unused_marker_k8s406 = False
changed:
  deployment.yaml: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: myapp
    spec:
      template:
        spec:
          containers:
          - name: app
            env:
            - name: DB_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: db-secret
                  key: password
assertions:
  must_include:
  - secretKeyRef
  must_not_include:
  - garbage_marker_k8s406
  - unused_marker_k8s406
options:
  commit_message: Add Secret reference
