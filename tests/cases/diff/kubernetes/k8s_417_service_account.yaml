name: k8s_417_service_account
initial:
  serviceaccount.yaml: |
    apiVersion: v1
    kind: ServiceAccount
    metadata:
      name: app-sa
    ---
    apiVersion: rbac.authorization.k8s.io/v1
    kind: Role
    metadata:
      name: app-role
    rules:
    - apiGroups: [""]
      resources: ["secrets"]
      verbs: ["get", "list"]
  deployment.yaml: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: myapp
    spec:
      template:
        spec:
          containers:
          - name: app
            image: myapp:latest
  unrelated.txt: |
    garbage_marker_k8s417 = True
    unused_marker_k8s417 = False
changed:
  deployment.yaml: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: myapp
    spec:
      template:
        spec:
          serviceAccountName: app-sa
          containers:
          - name: app
            image: myapp:latest
assertions:
  must_include:
  - serviceAccountName
  must_not_include:
  - garbage_marker_k8s417
  - unused_marker_k8s417
options:
  commit_message: Add service account
