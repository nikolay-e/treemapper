name: cpp_255_volatile
initial:
  hardware.h: |
    #pragma once
    #include <cstdint>

    struct HardwareRegister {
        volatile uint32_t status;
        volatile uint32_t control;
        volatile uint32_t data;
    };
    // garbage_marker_12345
  driver.cpp: |
    #include <iostream>
    int main() { return 0; }
changed:
  driver.cpp: |
    #include "hardware.h"

    class Driver {
        HardwareRegister* reg;

    public:
        Driver(HardwareRegister* r) : reg(r) {}

        void waitReady() {
            while (!(reg->status & 0x1)) {
                // Busy wait - volatile prevents optimization
            }
        }

        void write(uint32_t value) {
            reg->data = value;
            reg->control = 0x1;
        }
    };
assertions:
  must_include:
  - Driver
  - waitReady
  - HardwareRegister
  must_not_include:
  - garbage_marker_12345
  - unused_marker_67890
options:
  commit_message: Add volatile usage
