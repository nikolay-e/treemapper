src/exceptions.py: |
  class ValidationError(Exception):
      def __init__(self, field: str, message: str):
          self.field = field
          self.message = message
          super().__init__(f"{field}: {message}")

  class NotFoundError(Exception):
      def __init__(self, resource: str, identifier: str):
          self.resource = resource
          self.identifier = identifier
          super().__init__(f"{resource} with id {identifier} not found")

  class PermissionDeniedError(Exception):
      def __init__(self, action: str, resource: str):
          self.action = action
          self.resource = resource
          super().__init__(f"Permission denied: cannot {action} {resource}")
src/user_repository.py: |
  from src.exceptions import NotFoundError, ValidationError

  class UserRepository:
      def __init__(self):
          self.users = {}

      def get(self, user_id: int):
          if user_id not in self.users:
              raise NotFoundError("User", str(user_id))
          return self.users[user_id]

      def create(self, data: dict):
          if "email" not in data:
              raise ValidationError("email", "is required")
          if "name" not in data:
              raise ValidationError("name", "is required")
          user_id = len(self.users) + 1
          self.users[user_id] = {**data, "id": user_id}
          return self.users[user_id]
tests/test_user_repository.py: |
  import pytest
  from src.user_repository import UserRepository
  from src.exceptions import NotFoundError, ValidationError

  def test_create_user():
      repo = UserRepository()
      user = repo.create({"name": "Test", "email": "test@example.com"})
      assert user["name"] == "Test"

  def test_get_nonexistent_raises_not_found():
      repo = UserRepository()
      with pytest.raises(NotFoundError) as exc_info:
          repo.get(999)
      assert exc_info.value.resource == "User"
      assert exc_info.value.identifier == "999"

  def test_create_without_email_raises_validation_error():
      repo = UserRepository()
      with pytest.raises(ValidationError) as exc_info:
          repo.create({"name": "Test"})
      assert exc_info.value.field == "email"
      assert "required" in exc_info.value.message

  def test_create_without_name_raises_validation_error():
      repo = UserRepository()
      with pytest.raises(ValidationError) as exc_info:
          repo.create({"email": "test@example.com"})
      assert exc_info.value.field == "name"
