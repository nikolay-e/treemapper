name: python_055_fastapi_dependency_injection
initial:
  dependencies.py: |
    from fastapi import Depends, HTTPException
    from database import get_db

    async def get_current_user(db = Depends(get_db)):
        user = await db.get_user()
        if not user:
            raise HTTPException(status_code=401)
        return user
  routers/protected.py: |
    from fastapi import APIRouter
  garbage.py: |
    garbage_marker_12345 = "di garbage"
    unused_marker_67890 = "unused di"
changed:
  routers/protected.py: |
    from fastapi import APIRouter, Depends
    from dependencies import get_current_user

    router = APIRouter()

    @router.get("/profile")
    async def get_profile(user = Depends(get_current_user)):
        return {"user": user}
assertions:
  must_include:
  - async def get_current_user
  must_not_include:
  - garbage_marker_12345
  - unused_marker_67890
