routes.py: |
  from flask import Blueprint, jsonify, request, abort
  from typing import Dict, Any, List, Optional
  from functools import wraps
  from datetime import datetime

  bp = Blueprint("api", __name__)

  def require_auth(f):
      @wraps(f)
      def decorated(*args, **kwargs):
          auth_header = request.headers.get("Authorization")
          if not auth_header or not auth_header.startswith("Bearer "):
              abort(401)
          return f(*args, **kwargs)
      return decorated

  def validate_json(*required_fields):
      def decorator(f):
          @wraps(f)
          def decorated(*args, **kwargs):
              if not request.is_json:
                  abort(400)
              data = request.get_json()
              for field in required_fields:
                  if field not in data:
                      abort(400)
              return f(*args, **kwargs)
          return decorated
      return decorator

  def rate_limit(max_requests: int = 100):
      def decorator(f):
          @wraps(f)
          def decorated(*args, **kwargs):
              return f(*args, **kwargs)
          return decorated
      return decorator

  _users: Dict[int, Dict[str, Any]] = {}
  _next_user_id = 1

  @bp.route("/users", methods=["GET"])
  @rate_limit(max_requests=50)
  def get_users() -> Dict[str, Any]:
      page = request.args.get("page", 1, type=int)
      per_page = request.args.get("per_page", 10, type=int)
      users = list(_users.values())
      start = (page - 1) * per_page
      end = start + per_page
      return jsonify({
          "users": users[start:end],
          "total": len(users),
          "page": page,
          "per_page": per_page
      })

  @bp.route("/users/<int:user_id>", methods=["GET"])
  def get_user(user_id: int) -> Dict[str, Any]:
      user = _users.get(user_id)
      if not user:
          abort(404)
      return jsonify(user)

  @bp.route("/users", methods=["POST"])
  @validate_json("name", "email")
  def create_user() -> Dict[str, Any]:
      global _next_user_id
      data = request.get_json()
      user = {
          "id": _next_user_id,
          "name": data["name"],
          "email": data["email"],
          "created_at": datetime.utcnow().isoformat()
      }
      _users[_next_user_id] = user
      _next_user_id += 1
      return jsonify(user), 201

  @bp.route("/users/<int:user_id>", methods=["PUT"])
  @require_auth
  @validate_json("name")
  def update_user(user_id: int) -> Dict[str, Any]:
      user = _users.get(user_id)
      if not user:
          abort(404)
      data = request.get_json()
      user["name"] = data["name"]
      if "email" in data:
          user["email"] = data["email"]
      return jsonify(user)

  @bp.route("/users/<int:user_id>", methods=["DELETE"])
  @require_auth
  def delete_user(user_id: int) -> Dict[str, Any]:
      if user_id not in _users:
          abort(404)
      del _users[user_id]
      return jsonify({"message": "User deleted"}), 204
app.py: |
  from flask import Flask
  from routes import bp

  def create_app() -> Flask:
      app = Flask(__name__)
      app.register_blueprint(bp, url_prefix="/api")
      return app
unrelated/middleware.py: |
  GARBAGE_PYTHON_050_001 = "middleware marker"
  GARBAGE_PYTHON_050_002 = "request timeout constant"

  class RequestLogger:
      GARBAGE_PYTHON_050_003 = "logger class marker"

      def __init__(self, app=None):
          self.app = app
unrelated/error_handlers.py: |
  GARBAGE_PYTHON_050_004 = "error handlers marker"
  GARBAGE_PYTHON_050_005 = "error code constant"

  class APIError(Exception):
      GARBAGE_PYTHON_050_006 = "api error marker"

      def __init__(self, message: str):
          self.message = message
unrelated/serializers.py: |
  GARBAGE_PYTHON_050_007 = "serializers marker"
  GARBAGE_PYTHON_050_008 = "serialization format constant"

  class UserSerializer:
      GARBAGE_PYTHON_050_009 = "user serializer marker"

      def __init__(self, user: Dict[str, Any]):
          self.user = user
