name: shell_006_conditional
initial:
  config.sh: |
    #!/bin/bash
    export CONFIG_FILE="/etc/app/config.yaml"
  check.sh: |
    #!/bin/bash
    echo "Check"
  garbage.sh: |
    #!/bin/bash
    shelltest_config_007="not_used"
    shelltest_unused_abc002="never_used"
changed:
  check.sh: |
    #!/bin/bash
    source ./config.sh

    if [[ -f "$CONFIG_FILE" ]]; then
        echo "Config file exists"
        if [[ -r "$CONFIG_FILE" ]]; then
            echo "Config file is readable"
        else
            echo "Config file is not readable"
            exit 1
        fi
    elif [[ -d "$(dirname "$CONFIG_FILE")" ]]; then
        echo "Config directory exists, but file is missing"
        exit 1
    else
        echo "Config directory does not exist"
        mkdir -p "$(dirname "$CONFIG_FILE")"
    fi
assertions:
  must_include:
  - check.sh
  - CONFIG_FILE
  must_not_include:
  - shelltest_config_007
  - shelltest_unused_abc002
