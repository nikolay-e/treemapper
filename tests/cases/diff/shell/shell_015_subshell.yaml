name: shell_015_subshell
initial:
  config.sh: |
    #!/bin/bash
    export BUILD_DIR="/tmp/build"
  build.sh: |
    #!/bin/bash
    echo "Build"
  garbage.sh: |
    #!/bin/bash
    SHELLTEST_SUBSHELL_016="unused_build_path"
    unused_marker_12345="not_used"
changed:
  build.sh: |
    #!/bin/bash
    source ./config.sh

    (cd "$BUILD_DIR" && make clean && make)

    result=$(
        cd /tmp
        echo "Working in: $(pwd)"
        ls -la
    )

    (
        export CUSTOM_VAR="value"
        ./run-with-custom-env.sh
    )

    echo "Still in original directory: $(pwd)"
assertions:
  must_include:
  - build.sh
  - BUILD_DIR
  must_not_include:
  - SHELLTEST_SUBSHELL_016
  - unused_marker_12345
