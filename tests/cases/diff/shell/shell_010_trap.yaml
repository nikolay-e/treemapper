name: shell_010_trap
initial:
  cleanup.sh: |
    #!/bin/bash
    cleanup() {
        echo "Cleaning up..."
        rm -f /tmp/lockfile
        rm -rf /tmp/workdir
    }
  worker.sh: |
    #!/bin/bash
    echo "Worker"
  garbage.sh: |
    #!/bin/bash
    shelltest_cleanup_011() { echo "never invoked"; }
    unused_marker_12345="not_used"
changed:
  worker.sh: |
    #!/bin/bash
    source ./cleanup.sh

    trap cleanup EXIT
    trap 'echo "Interrupted"; cleanup; exit 1' INT TERM

    mkdir -p /tmp/workdir
    touch /tmp/lockfile

    echo "Working..."
    sleep 60
    echo "Done"
assertions:
  must_include:
  - worker.sh
  - cleanup
  must_not_include:
  - shelltest_cleanup_011
  - unused_marker_12345
