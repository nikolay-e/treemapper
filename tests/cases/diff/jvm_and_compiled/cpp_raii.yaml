name: cpp_raii
initial:
  mutex.h: |
    #pragma once

    class Mutex {
    public:
        void lock() {}
        void unlock() {}
    };
  guard.cpp: |
    #include <iostream>
    int main() { return 0; }
changed:
  guard.cpp: |
    #include "mutex.h"

    class LockGuard {
        Mutex& mutex_;

    public:
        explicit LockGuard(Mutex& m) : mutex_(m) {
            mutex_.lock();
        }

        ~LockGuard() {
            mutex_.unlock();
        }

        LockGuard(const LockGuard&) = delete;
        LockGuard& operator=(const LockGuard&) = delete;
    };

    void criticalSection(Mutex& m) {
        LockGuard guard(m);
        // Protected code
    }
assertions:
  must_include:
  - guard.cpp
  - LockGuard
  - ~LockGuard
options:
  commit_message: Add RAII pattern
