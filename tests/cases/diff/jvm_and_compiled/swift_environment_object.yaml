name: swift_environment_object
initial:
  AppState.swift: |
    import Combine

    class AppState: ObservableObject {
        @Published var currentUser: String?
        @Published var isLoggedIn = false

        func login(username: String) {
            currentUser = username
            isLoggedIn = true
        }

        func logout() {
            currentUser = nil
            isLoggedIn = false
        }
    }
  ProfileView.swift: |
    // Initial
    import SwiftUI
    struct ProfileView: View {
        var body: some View { Text("") }
    }
changed:
  ProfileView.swift: |
    import SwiftUI

    struct ProfileView: View {
        @EnvironmentObject var appState: AppState

        var body: some View {
            VStack {
                if appState.isLoggedIn {
                    Text("Welcome, \(appState.currentUser ?? "")")
                    Button("Logout") {
                        appState.logout()
                    }
                } else {
                    Text("Please log in")
                }
            }
        }
    }
assertions:
  must_include:
  - ProfileView.swift
  - '@EnvironmentObject'
  - appState.isLoggedIn
options:
  commit_message: Add @EnvironmentObject
