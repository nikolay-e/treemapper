name: dep_406_test_api_response_snapshot
initial:
  src/api_handlers.py: |
    from dataclasses import dataclass
    from typing import Optional
    import json

    @dataclass
    class ApiResponse:
        status: str
        data: Optional[dict] = None
        error: Optional[str] = None
        meta: Optional[dict] = None

        def to_json(self) -> str:
            result = {"status": self.status}
            if self.data is not None:
                result["data"] = self.data
            if self.error is not None:
                result["error"] = self.error
            if self.meta is not None:
                result["meta"] = self.meta
            return json.dumps(result, indent=2)

    class UserApiHandler:
        def __init__(self):
            self.users = {
                1: {"id": 1, "name": "Admin", "role": "admin"},
                2: {"id": 2, "name": "User", "role": "user"},
            }

        def get_user(self, user_id: int) -> ApiResponse:
            if user_id not in self.users:
                return ApiResponse(
                    status="error",
                    error=f"User {user_id} not found",
                    meta={"request_id": "req_123"}
                )
            return ApiResponse(
                status="success",
                data=self.users[user_id],
                meta={"request_id": "req_123", "cached": False}
            )

        def list_users(self, page: int = 1, limit: int = 10) -> ApiResponse:
            users = list(self.users.values())
            return ApiResponse(
                status="success",
                data={"users": users, "total": len(users)},
                meta={"page": page, "limit": limit}
            )
  tests/test_api_handlers.py: |
    from src.api_handlers import UserApiHandler

    def test_get_user_exists():
        handler = UserApiHandler()
        response = handler.get_user(1)
        assert response.status == "success"
changed:
  tests/test_api_handlers.py: |
    import json
    from src.api_handlers import UserApiHandler, ApiResponse

    def test_get_user_exists():
        handler = UserApiHandler()
        response = handler.get_user(1)
        assert response.status == "success"

    def test_get_user_success_snapshot():
        handler = UserApiHandler()
        response = handler.get_user(1)
        result = json.loads(response.to_json())

        assert result["status"] == "success"
        assert result["data"]["id"] == 1
        assert result["data"]["name"] == "Admin"
        assert result["data"]["role"] == "admin"
        assert "meta" in result
        assert result["meta"]["cached"] is False

    def test_get_user_not_found_snapshot():
        handler = UserApiHandler()
        response = handler.get_user(999)
        result = json.loads(response.to_json())

        assert result["status"] == "error"
        assert "999" in result["error"]
        assert "not found" in result["error"]
        assert "data" not in result

    def test_list_users_snapshot():
        handler = UserApiHandler()
        response = handler.list_users(page=1, limit=10)
        result = json.loads(response.to_json())

        assert result["status"] == "success"
        assert result["data"]["total"] == 2
        assert len(result["data"]["users"]) == 2
        assert result["meta"]["page"] == 1
        assert result["meta"]["limit"] == 10
assertions:
  must_include:
  - test_api_handlers.py
  must_not_include:
  - garbage_marker_12345
