name: dep_203_reverse_dependency_injection
initial:
  services/database.py: |
    class DatabaseService:
        def __init__(self, connection_string: str):
            self.connection_string = connection_string
            self.connected = False

        def connect(self) -> bool:
            self.connected = True
            return True

        def query(self, sql: str) -> list:
            return []
  repositories/user_repo.py: |
    from services.database import DatabaseService

    class UserRepository:
        def __init__(self, db_service: DatabaseService):
            self.db = db_service

        def find_by_id(self, user_id: int) -> dict:
            return self.db.query(f"SELECT * FROM users WHERE id = {user_id}")
  repositories/order_repo.py: |
    from services.database import DatabaseService

    class OrderRepository:
        def __init__(self, db_service: DatabaseService):
            self.db = db_service

        def get_orders(self, user_id: int) -> list:
            return self.db.query(f"SELECT * FROM orders WHERE user_id = {user_id}")
  handlers/api_handler.py: |
    from services.database import DatabaseService

    class ApiHandler:
        def __init__(self, db_service: DatabaseService):
            self.db = db_service

        def handle(self, request: dict) -> dict:
            self.db.connect()
            return {"status": "ok"}
changed:
  services/database.py: |
    class DatabaseService:
        def __init__(self, connection_string: str, pool_size: int = 5):
            self.connection_string = connection_string
            self.pool_size = pool_size
            self.connected = False
            self.pool = []

        def connect(self) -> bool:
            self.pool = [None] * self.pool_size
            self.connected = True
            return True

        def query(self, sql: str) -> list:
            if not self.connected:
                self.connect()
            return []

        def close(self) -> None:
            self.pool.clear()
            self.connected = False
assertions:
  must_include:
  - database.py
  - class DatabaseService
  must_not_include:
  - garbage_marker_12345
