name: java_051_kotlin_suspend_fun
initial:
  src/main/kotlin/com/example/UserService.kt: |
    package com.example

    class UserService(private val repository: UserRepository) {
        suspend fun getUser(id: Long): User? {
            return repository.findById(id)
        }
    }
  src/main/kotlin/com/example/UserController.kt: |
    package com.example

    import kotlinx.coroutines.runBlocking

    class UserController(private val service: UserService) {
        fun getUser(id: Long): User? = runBlocking {
            service.getUser(id)
        }
    }
changed:
  src/main/kotlin/com/example/UserService.kt: |
    package com.example

    import kotlinx.coroutines.delay

    class UserService(private val repository: UserRepository) {
        suspend fun getUser(id: Long): User? {
            return repository.findById(id)
        }

        suspend fun getUserWithRetry(id: Long, retries: Int = 3): User? {
            repeat(retries) { attempt ->
                try {
                    return repository.findById(id)
                } catch (e: Exception) {
                    delay(1000L * (attempt + 1))
                }
            }
            return null
        }
    }
assertions:
  must_include:
  - suspend fun
  - getUserWithRetry
  - delay
  must_not_include:
  - garbage_marker_12345
  - unused_marker_67890
options:
  commit_message: Add getUserWithRetry with coroutine delay
