name: java_014_transactional
initial:
  src/main/java/com/example/OrderService.java: |
    package com.example;

    import org.springframework.stereotype.Service;
    import org.springframework.transaction.annotation.Transactional;

    @Service
    public class OrderService {
        @Transactional
        public Order createOrder(Order order) {
            return orderRepository.save(order);
        }
    }
changed:
  src/main/java/com/example/OrderService.java: |
    package com.example;

    import org.springframework.stereotype.Service;
    import org.springframework.transaction.annotation.Transactional;
    import org.springframework.transaction.annotation.Propagation;
    import org.springframework.transaction.annotation.Isolation;

    @Service
    public class OrderService {
        @Transactional(
            propagation = Propagation.REQUIRED,
            isolation = Isolation.READ_COMMITTED,
            rollbackFor = Exception.class
        )
        public Order createOrder(Order order) {
            Order saved = orderRepository.save(order);
            inventoryService.updateStock(order.getItems());
            return saved;
        }

        @Transactional(readOnly = true)
        public Order getOrder(Long id) {
            return orderRepository.findById(id).orElse(null);
        }
    }
assertions:
  must_include:
  - '@Transactional'
  - OrderService
  - getOrder
  must_not_include:
  - garbage_marker_12345
  - unused_marker_67890
options:
  commit_message: Add transaction configuration and getOrder
