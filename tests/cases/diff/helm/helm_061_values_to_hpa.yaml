name: helm_061_values_to_hpa
initial:
  chart/values.yaml: |
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 10
  chart/templates/hpa.yaml: |
    {{- if .Values.autoscaling.enabled }}
    apiVersion: autoscaling/v2
    kind: HorizontalPodAutoscaler
    metadata:
      name: {{ .Release.Name }}
    spec:
      minReplicas: {{ .Values.autoscaling.minReplicas }}
      maxReplicas: {{ .Values.autoscaling.maxReplicas }}
    {{- end }}
changed:
  chart/values.yaml: |
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 20
      targetCPU: 80
assertions:
  must_include:
    - HorizontalPodAutoscaler
options:
  commit_message: enable hpa
