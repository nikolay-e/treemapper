name: helm_070_values_service_account
initial:
  chart/values.yaml: |
    serviceAccount:
      create: false
  chart/templates/serviceaccount.yaml: |
    {{- if .Values.serviceAccount.create }}
    apiVersion: v1
    kind: ServiceAccount
    metadata:
      name: {{ .Release.Name }}
      annotations:
        {{- toYaml .Values.serviceAccount.annotations | nindent 4 }}
    {{- end }}
changed:
  chart/values.yaml: |
    serviceAccount:
      create: true
      name: app-sa
      annotations:
        eks.amazonaws.com/role-arn: arn:aws:iam::123456789:role/app-role
assertions:
  must_include:
    - ServiceAccount
options:
  commit_message: create service account
