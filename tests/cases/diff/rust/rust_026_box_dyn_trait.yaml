name: rust_026_box_dyn_trait
initial:
  src/plugin.rs: |
    pub trait Plugin {
        fn name(&self) -> &str;
        fn execute(&self);
    }

    pub struct PluginManager {
        plugins: Vec<Box<dyn Plugin>>,
    }

    impl PluginManager {
        pub fn new() -> Self {
            Self { plugins: vec![] }
        }

        pub fn register(&mut self, plugin: Box<dyn Plugin>) {
            self.plugins.push(plugin);
        }
    }
changed:
  src/plugin.rs: |
    pub trait Plugin: Send + Sync {
        fn name(&self) -> &str;
        fn execute(&self);
        fn priority(&self) -> i32 { 0 }
    }

    pub struct PluginManager {
        plugins: Vec<Box<dyn Plugin>>,
    }

    impl PluginManager {
        pub fn new() -> Self {
            Self { plugins: vec![] }
        }

        pub fn register(&mut self, plugin: Box<dyn Plugin>) {
            self.plugins.push(plugin);
            self.plugins.sort_by_key(|p| -p.priority());
        }

        pub fn execute_all(&self) {
            for plugin in &self.plugins {
                plugin.execute();
            }
        }
    }
assertions:
  must_include:
  - priority
  - execute_all
  - Send + Sync
  must_not_include:
  - garbage_plugin_method
options:
  commit_message: Add priority and execute_all
