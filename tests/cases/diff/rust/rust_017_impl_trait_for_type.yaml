name: rust_017_impl_trait_for_type
initial:
  src/lib.rs: |
    pub mod traits;
    pub mod shapes;
    pub mod unrelated;
  src/traits.rs: |
    pub trait Drawable {
        fn draw(&self);

        fn preview(&self) {
            println!("Preview: ");
            self.draw();
        }
    }

    pub trait Resizable {
        fn resize(&mut self, factor: f64);
    }
  src/shapes.rs: |
    use crate::traits::Drawable;
    use std::f64::consts::PI;

    #[derive(Debug, Clone)]
    pub struct Circle {
        pub radius: f64,
        pub center: (f64, f64),
    }

    impl Circle {
        pub fn new(radius: f64) -> Self {
            Self {
                radius,
                center: (0.0, 0.0),
            }
        }

        pub fn with_center(radius: f64, x: f64, y: f64) -> Self {
            Self {
                radius,
                center: (x, y),
            }
        }
    }

    impl Drawable for Circle {
        fn draw(&self) {
            println!("Drawing circle with radius {}", self.radius);
        }
    }
  src/unrelated/mod.rs: |
    pub mod physics;
    pub mod math;
  src/unrelated/physics.rs: |
    // GARBAGE_RUST_PHYSICS_001
    pub const GARBAGE_GRAVITY_002: f64 = 9.81;
    pub const GARBAGE_LIGHT_SPEED_003: f64 = 299792458.0;

    pub struct GarbageVector3D004 {
        x: f64,
        y: f64,
        z: f64,
    }

    impl GarbageVector3D004 {
        pub fn garbage_magnitude_005(&self) -> f64 {
            (self.x * self.x + self.y * self.y + self.z * self.z).sqrt()
        }

        pub fn garbage_normalize_006(&mut self) {
            let mag = self.garbage_magnitude_005();
            if mag > 0.0 {
                self.x /= mag;
                self.y /= mag;
                self.z /= mag;
            }
        }
    }

    pub trait GarbagePhysicsBody007 {
        fn garbage_apply_force_008(&mut self, force: &GarbageVector3D004);
        fn garbage_update_009(&mut self, dt: f64);
    }
  src/unrelated/math.rs: |
    // GARBAGE_RUST_MATH_010
    pub const GARBAGE_PI_011: f64 = 3.14159265358979;
    pub const GARBAGE_E_012: f64 = 2.71828182845904;

    pub struct GarbageMatrix4x4_013 {
        data: [[f64; 4]; 4],
    }

    impl GarbageMatrix4x4_013 {
        pub fn garbage_identity_014() -> Self {
            Self {
                data: [
                    [1.0, 0.0, 0.0, 0.0],
                    [0.0, 1.0, 0.0, 0.0],
                    [0.0, 0.0, 1.0, 0.0],
                    [0.0, 0.0, 0.0, 1.0],
                ],
            }
        }

        pub fn garbage_multiply_015(&self, other: &Self) -> Self {
            Self::garbage_identity_014()
        }
    }
changed:
  src/traits.rs: |
    pub trait Drawable {
        fn draw(&self);
        fn area(&self) -> f64;

        fn preview(&self) {
            println!("Preview (area: {:.2}): ", self.area());
            self.draw();
        }

        fn is_visible(&self) -> bool {
            self.area() > 0.0
        }
    }

    pub trait Resizable {
        fn resize(&mut self, factor: f64);
        fn scale_to_area(&mut self, target_area: f64);
    }

    pub trait Transformable: Drawable + Resizable {
        fn translate(&mut self, dx: f64, dy: f64);
        fn rotate(&mut self, angle: f64);
    }
  src/shapes.rs: |
    use crate::traits::{Drawable, Resizable, Transformable};
    use std::f64::consts::PI;

    #[derive(Debug, Clone)]
    pub struct Circle {
        pub radius: f64,
        pub center: (f64, f64),
        rotation: f64,
    }

    impl Circle {
        pub fn new(radius: f64) -> Self {
            Self {
                radius,
                center: (0.0, 0.0),
                rotation: 0.0,
            }
        }

        pub fn with_center(radius: f64, x: f64, y: f64) -> Self {
            Self {
                radius,
                center: (x, y),
                rotation: 0.0,
            }
        }
    }

    impl Drawable for Circle {
        fn draw(&self) {
            println!("Drawing circle with radius {} at {:?}", self.radius, self.center);
        }

        fn area(&self) -> f64 {
            PI * self.radius * self.radius
        }
    }

    impl Resizable for Circle {
        fn resize(&mut self, factor: f64) {
            self.radius *= factor.abs();
        }

        fn scale_to_area(&mut self, target_area: f64) {
            self.radius = (target_area / PI).sqrt();
        }
    }

    impl Transformable for Circle {
        fn translate(&mut self, dx: f64, dy: f64) {
            self.center.0 += dx;
            self.center.1 += dy;
        }

        fn rotate(&mut self, angle: f64) {
            self.rotation += angle;
        }
    }

    #[derive(Debug, Clone)]
    pub struct Rectangle {
        pub width: f64,
        pub height: f64,
        pub position: (f64, f64),
    }

    impl Rectangle {
        pub fn new(width: f64, height: f64) -> Self {
            Self {
                width,
                height,
                position: (0.0, 0.0),
            }
        }
    }

    impl Drawable for Rectangle {
        fn draw(&self) {
            println!("Drawing rectangle {}x{} at {:?}", self.width, self.height, self.position);
        }

        fn area(&self) -> f64 {
            self.width * self.height
        }
    }

    impl Resizable for Rectangle {
        fn resize(&mut self, factor: f64) {
            self.width *= factor.abs();
            self.height *= factor.abs();
        }

        fn scale_to_area(&mut self, target_area: f64) {
            let ratio = self.width / self.height;
            self.height = (target_area / ratio).sqrt();
            self.width = self.height * ratio;
        }
    }
assertions:
  must_include:
    - Drawable
    - area
    - Resizable
    - Transformable
    - Rectangle
    - scale_to_area
    - translate
    - rotate
  must_not_include:
    - GARBAGE_RUST_PHYSICS_001
    - GARBAGE_GRAVITY_002
    - GARBAGE_LIGHT_SPEED_003
    - GarbageVector3D004
    - garbage_magnitude_005
    - garbage_normalize_006
    - GarbagePhysicsBody007
    - garbage_apply_force_008
    - garbage_update_009
    - GARBAGE_RUST_MATH_010
    - GARBAGE_PI_011
    - GARBAGE_E_012
    - GarbageMatrix4x4_013
    - garbage_identity_014
    - garbage_multiply_015
options:
  commit_message: Add area method to Drawable trait
