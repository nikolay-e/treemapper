name: rust_028_build_rs
initial:
  build.rs: |
    fn main() {
        println!("cargo:rerun-if-changed=proto/");
        tonic_build::compile_protos("proto/service.proto").unwrap();
    }
  src/service.rs: |
    pub mod proto {
        tonic::include_proto!("service");
    }

    pub use proto::service_server::Service;
changed:
  build.rs: |
    fn main() {
        println!("cargo:rerun-if-changed=proto/");

        tonic_build::configure()
            .build_server(true)
            .build_client(true)
            .compile(&["proto/service.proto", "proto/types.proto"], &["proto/"])
            .unwrap();
    }
assertions:
  must_include:
  - build_client
  - types.proto
  - configure
  must_not_include:
  - garbage_build_option
options:
  commit_message: Add types.proto and client generation
