derive_macro/src/lib.rs: |
  use proc_macro::TokenStream;
  use quote::quote;
  use syn::{parse_macro_input, DeriveInput, Data, Fields};

  #[proc_macro_derive(MyTrait, attributes(my_attr))]
  pub fn my_trait_derive(input: TokenStream) -> TokenStream {
      let input = parse_macro_input!(input as DeriveInput);
      let name = input.ident;

      let field_count = match input.data {
          Data::Struct(ref data) => match data.fields {
              Fields::Named(ref fields) => fields.named.len(),
              Fields::Unnamed(ref fields) => fields.unnamed.len(),
              Fields::Unit => 0,
          },
          _ => 0,
      };

      let expanded = quote! {
          impl MyTrait for #name {
              fn name(&self) -> &str {
                  stringify!(#name)
              }

              fn field_count(&self) -> usize {
                  #field_count
              }
          }
      };

      TokenStream::from(expanded)
  }
src/main.rs: |
  use derive_macro::MyTrait;

  pub trait MyTrait {
      fn name(&self) -> &str;
      fn field_count(&self) -> usize;
  }

  #[derive(MyTrait)]
  struct MyStruct {
      value: i32,
  }

  fn main() {
      let s = MyStruct { value: 42 };
      println!("Name: {}, fields: {}", s.name(), s.field_count());
  }
src/unrelated/mod.rs: |
  pub mod renderer;
  pub mod encoder;
src/unrelated/renderer.rs: |
  // GARBAGE_RUST_029_RENDERER_A
  pub const GARBAGE_RUST_029_RENDER_FMT_B: &str = "html";

  pub struct GarbageTemplateRenderer029 {
      template_dir: String,
  }

  impl GarbageTemplateRenderer029 {
      pub fn garbage_render_029(&self, name: &str) -> String {
          format!("<html>{}</html>", name)
      }

      pub fn garbage_render_partial_029(&self, partial: &str) -> String {
          format!("<div>{}</div>", partial)
      }
  }
src/unrelated/encoder.rs: |
  // GARBAGE_RUST_029_ENCODER_C
  pub const GARBAGE_RUST_029_ENCODING_D: &str = "utf-8";

  pub struct GarbageBase64Encoder029;

  impl GarbageBase64Encoder029 {
      pub fn garbage_encode_029(&self, data: &[u8]) -> String {
          data.iter().map(|b| format!("{:02x}", b)).collect()
      }

      pub fn garbage_decode_029(&self, hex: &str) -> Vec<u8> {
          vec![0u8; hex.len() / 2]
      }
  }
