name: rust_015_const_and_static
initial:
  src/lib.rs: |
    pub mod config;
    pub mod unrelated;
  src/config.rs: |
    pub const MAX_SIZE: usize = 100;

    pub fn get_max_size() -> usize {
        MAX_SIZE
    }

    pub struct Settings {
        pub size: usize,
    }

    impl Settings {
        pub fn new(size: usize) -> Self {
            Self { size: size.min(MAX_SIZE) }
        }
    }

    impl Default for Settings {
        fn default() -> Self {
            Self { size: MAX_SIZE }
        }
    }
  src/unrelated/mod.rs: |
    pub mod benchmark;
    pub mod profiler;
  src/unrelated/benchmark.rs: |
    // GARBAGE_RUST_BENCH_001
    use std::time::{Duration, Instant};

    pub const GARBAGE_WARMUP_ITERATIONS_002: u32 = 100;
    pub const GARBAGE_BENCH_ITERATIONS_003: u32 = 1000;

    pub struct GarbageBenchmark004 {
        name: String,
        iterations: u32,
    }

    impl GarbageBenchmark004 {
        pub fn garbage_run_005<F>(&self, f: F) -> Duration
        where
            F: Fn(),
        {
            let start = Instant::now();
            for _ in 0..self.iterations {
                f();
            }
            start.elapsed()
        }

        pub fn garbage_compare_006<F, G>(&self, f: F, g: G) -> (Duration, Duration)
        where
            F: Fn(),
            G: Fn(),
        {
            (self.garbage_run_005(f), self.garbage_run_005(g))
        }
    }

    pub trait GarbageBenchmarkable007 {
        fn garbage_benchmark_008(&self) -> Duration;
    }
  src/unrelated/profiler.rs: |
    // GARBAGE_RUST_PROFILER_009
    use std::collections::HashMap;

    pub const GARBAGE_PROFILE_DEPTH_010: usize = 32;

    pub struct GarbageProfiler011 {
        traces: HashMap<String, Vec<u64>>,
    }

    impl GarbageProfiler011 {
        pub fn garbage_start_012(&mut self, name: &str) {
            // GARBAGE_PROFILE_START_013
        }

        pub fn garbage_stop_014(&mut self, name: &str) {
            // GARBAGE_PROFILE_STOP_015
        }

        pub fn garbage_report_016(&self) -> String {
            "GARBAGE_PROFILE_REPORT_017".to_string()
        }
    }
changed:
  src/config.rs: |
    use std::sync::atomic::{AtomicUsize, Ordering};

    pub const MAX_SIZE: usize = 100;
    pub const MIN_SIZE: usize = 10;
    pub const DEFAULT_NAME: &str = "unnamed";
    pub const VERSION: &str = env!("CARGO_PKG_VERSION");

    pub static INSTANCE_COUNT: AtomicUsize = AtomicUsize::new(0);

    static mut GLOBAL_CONFIG: Option<Config> = None;

    pub fn get_max_size() -> usize {
        MAX_SIZE
    }

    pub fn get_instance_count() -> usize {
        INSTANCE_COUNT.load(Ordering::SeqCst)
    }

    pub fn increment_instance_count() -> usize {
        INSTANCE_COUNT.fetch_add(1, Ordering::SeqCst)
    }

    #[derive(Debug, Clone)]
    pub struct Config {
        pub name: String,
        pub size: usize,
        pub enabled: bool,
    }

    impl Config {
        pub fn new(name: &str, size: usize) -> Self {
            increment_instance_count();
            Self {
                name: name.to_string(),
                size: size.clamp(MIN_SIZE, MAX_SIZE),
                enabled: true,
            }
        }

        pub fn with_defaults() -> Self {
            Self::new(DEFAULT_NAME, MAX_SIZE)
        }

        pub fn is_valid(&self) -> bool {
            self.size >= MIN_SIZE && self.size <= MAX_SIZE
        }
    }

    impl Default for Config {
        fn default() -> Self {
            Self::with_defaults()
        }
    }

    pub fn get_default_config() -> Config {
        Config::with_defaults()
    }

    pub struct Settings {
        pub size: usize,
        pub name: String,
    }

    impl Settings {
        pub fn new(size: usize) -> Self {
            Self {
                size: size.clamp(MIN_SIZE, MAX_SIZE),
                name: DEFAULT_NAME.to_string(),
            }
        }

        pub fn with_name(size: usize, name: &str) -> Self {
            Self {
                size: size.clamp(MIN_SIZE, MAX_SIZE),
                name: name.to_string(),
            }
        }
    }

    impl Default for Settings {
        fn default() -> Self {
            Self::new(MAX_SIZE)
        }
    }
assertions:
  must_include:
    - MIN_SIZE
    - DEFAULT_NAME
    - INSTANCE_COUNT
    - Config
    - AtomicUsize
    - get_instance_count
  must_not_include:
    - GARBAGE_RUST_BENCH_001
    - GARBAGE_WARMUP_ITERATIONS_002
    - GARBAGE_BENCH_ITERATIONS_003
    - GarbageBenchmark004
    - garbage_run_005
    - garbage_compare_006
    - GarbageBenchmarkable007
    - garbage_benchmark_008
    - GARBAGE_RUST_PROFILER_009
    - GARBAGE_PROFILE_DEPTH_010
    - GarbageProfiler011
    - garbage_start_012
    - GARBAGE_PROFILE_START_013
    - garbage_stop_014
    - GARBAGE_PROFILE_STOP_015
    - garbage_report_016
    - GARBAGE_PROFILE_REPORT_017
options:
  commit_message: Add constants and Config struct
